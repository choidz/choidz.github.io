name: 🪄 Auto Post from Naver Blog

on:
  schedule:
    - cron: "0 * * * *" # 매 시간 정각마다 실행 (UTC 기준)
  workflow_dispatch: # 수동 실행 버튼도 활성화

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 Checkout repository
        uses: actions/checkout@v4

      - name: 🐍 Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: 📦 Install dependencies
        run: |
          pip install feedparser html2text python-dotenv requests beautifulsoup4

      - name: 🧠 Run auto_post.py
        env:
          NAVER_RSS_URL: ${{ secrets.NAVER_RSS_URL }}
          GIT_USER_NAME: ${{ secrets.GIT_USER_NAME }}
          GIT_USER_EMAIL: ${{ secrets.GIT_USER_EMAIL }}
        run: python auto_post.py

      - name: 🔀 Commit & Push to auto-post branch
        run: |
          git config --global user.name "${{ secrets.GIT_USER_NAME }}"
          git config --global user.email "${{ secrets.GIT_USER_EMAIL }}"
          git fetch origin
          git checkout -B auto-post
          git add .
          git commit -m "🤖 Auto post update $(date '+%Y-%m-%d %H:%M:%S')" || echo "No changes to commit"
          git push -u origin auto-post --force
