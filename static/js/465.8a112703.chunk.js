/*! For license information please see 465.8a112703.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkchoidz_github_io=self.webpackChunkchoidz_github_io||[]).push([[465],{2030:(t,e,n)=>{n.d(e,{BH:()=>d,LL:()=>C,ZR:()=>S,L:()=>o,Sg:()=>p,vZ:()=>A,aH:()=>l,P0:()=>h,m9:()=>N,z$:()=>w,Xx:()=>f,hl:()=>b,G6:()=>_,Uo:()=>g,dp:()=>v,eu:()=>T});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296===(64512&s)&&r+1<t.length&&56320===(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const e=t[s],i=s+1<t.length,o=i?t[s+1]:0,a=s+2<t.length,c=a?t[s+2]:0,u=e>>2,h=(3&e)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const e=n[t.charAt(s++)],o=s<t.length?n[t.charAt(s)]:0;++s;const a=s<t.length?n[t.charAt(s)]:64;++s;const c=s<t.length?n[t.charAt(s)]:64;if(++s,null==e||null==o||null==a||null==c)throw new i;const u=e<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=r(t);return s.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return s.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};const c=()=>function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,u=()=>{try{return c()||(()=>{if("undefined"===typeof process)return;const t={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_PROJECT_ID:"choidz-blog",REACT_APP_FIREBASE_API_KEY:"AIzaSyDV4thp2voWT8dSwiw956EXG-xgeOpz17E"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"===typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(t))}},h=t=>{const e=(t=>{var e;return null===(e=u())||void 0===e||null===(e=e.emulatorHosts)||void 0===e?void 0:e[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error("Invalid host ".concat(e," with no separate hostname and port!"));const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},l=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"===typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function f(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function g(t){return(await fetch(t,{credentials:"include"})).ok}function p(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i={iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}},...t};return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(i)),""].join(".")}const m={};let y=!1;function v(t,e){if("undefined"===typeof window||"undefined"===typeof document||!f(window.location.host)||m[t]===e||m[t]||y)return;function n(t){return"__firebase__banner__".concat(t)}m[t]=e;const r="__firebase__banner",s=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(m))m[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function i(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{y=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}function o(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),o=document.getElementById(e)||document.createElement("span"),a=n("learnmore"),c=document.getElementById(a)||document.createElement("a"),u=n("preprendIcon"),h=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(c,a);const n=i();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(h,u),e.append(h,o,c,n),document.body.appendChild(e)}s?(o.innerText="Preview backend disconnected.",h.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(h.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function w(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function E(){var t;const e=null===(t=u())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(r){return!1}}function _(){return!E()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function b(){try{return"object"===typeof indexedDB}catch(t){return!1}}function T(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(n){e(n)}}))}class S extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,C.prototype.create)}}class C{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t){const e=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(t),r=this.errors[t],s=r?function(t,e){return t.replace(I,((t,n)=>{const r=e[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,e):"Error",i="".concat(this.serviceName,": ").concat(s," (").concat(n,").");return new S(n,i,e)}}const I=/\{\$([^}]+)}/g;function A(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(D(n)&&D(i)){if(!A(n,i))return!1}else if(n!==i)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function D(t){return null!==t&&"object"===typeof t}function N(t){return t&&t._delegate?t._delegate:t}},168:(t,e,n)=>{function r(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}n.d(e,{Z:()=>r})},7949:(t,e,n)=>{n.d(e,{Jn:()=>U,qX:()=>L,rh:()=>M,Xd:()=>O,Mq:()=>j,ZF:()=>B,KN:()=>q});var r=n(5726),s=n(510),i=n(2030);const o=(t,e)=>e.some((e=>t instanceof e));let a,c;const u=new WeakMap,h=new WeakMap,l=new WeakMap,d=new WeakMap,f=new WeakMap;let g={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return h.get(t);if("objectStoreNames"===e)return t.objectStoreNames||l.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function p(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(c||(c=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t.apply(v(this),n),y(u.get(this))}:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return y(t.apply(v(this),n))}:function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];const i=t.call(v(this),e,...r);return l.set(i,e.sort?e.sort():[e]),y(i)}}function m(t){return"function"===typeof t?p(t):(t instanceof IDBTransaction&&function(t){if(h.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));h.set(t,e)}(t),o(t,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,g):t)}function y(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(y(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&u.set(e,t)})).catch((()=>{})),f.set(e,t),e}(t);if(d.has(t))return d.get(t);const e=m(t);return e!==t&&(d.set(t,e),f.set(e,t)),e}const v=t=>f.get(t);const w=["get","getKey","getAll","getAllKeys","count"],E=["put","add","delete","clear"],_=new Map;function b(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!==typeof e)return;if(_.get(e))return _.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=E.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!w.includes(n))return;const i=async function(t){const e=this.transaction(t,s?"readwrite":"readonly");let i=e.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),c=1;c<o;c++)a[c-1]=arguments[c];return r&&(i=i.index(a.shift())),(await Promise.all([i[n](...a),s&&e.done]))[0]};return _.set(e,i),i}g=(t=>({...t,get:(e,n,r)=>b(e,n)||t.get(e,n,r),has:(e,n)=>!!b(e,n)||t.has(e,n)}))(g);class T{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null===e||void 0===e?void 0:e.type)}(t)){const e=t.getImmediate();return"".concat(e.library,"/").concat(e.version)}return null})).filter((t=>t)).join(" ")}}const S="@firebase/app",C="0.14.6",I=new s.Yd("@firebase/app"),A="[DEFAULT]",D={[S]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},N=new Map,k=new Map,R=new Map;function x(t,e){try{t.container.addComponent(e)}catch(n){I.debug("Component ".concat(e.name," failed to register with FirebaseApp ").concat(t.name),n)}}function O(t){const e=t.name;if(R.has(e))return I.debug("There were multiple attempts to register component ".concat(e,".")),!1;R.set(e,t);for(const n of N.values())x(n,t);for(const n of k.values())x(n,t);return!0}function L(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function M(t){return null!==t&&void 0!==t&&void 0!==t.settings}const V={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},P=new i.LL("app","Firebase",V);class F{constructor(t,e,n){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw P.create("app-deleted",{appName:this._name})}}const U="12.6.0";function B(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if("object"!==typeof e){e={name:e}}const s={name:A,automaticDataCollectionEnabled:!0,...e},o=s.name;if("string"!==typeof o||!o)throw P.create("bad-app-name",{appName:String(o)});if(n||(n=(0,i.aH)()),!n)throw P.create("no-options");const a=N.get(o);if(a){if((0,i.vZ)(n,a.options)&&(0,i.vZ)(s,a.config))return a;throw P.create("duplicate-app",{appName:o})}const c=new r.H0(o);for(const r of R.values())c.addComponent(r);const u=new F(n,s,c);return N.set(o,u),u}function j(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A;const e=N.get(t);if(!e&&t===A&&(0,i.aH)())return B();if(!e)throw P.create("no-app",{appName:t});return e}function q(t,e,n){var s;let i=null!==(s=D[t])&&void 0!==s?s:t;n&&(i+="-".concat(n));const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=['Unable to register library "'.concat(i,'" with version "').concat(e,'":')];return o&&t.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),o&&a&&t.push("and"),a&&t.push('version name "'.concat(e,'" contains illegal characters (whitespace or "/")')),void I.warn(t.join(" "))}O(new r.wA("".concat(i,"-version"),(()=>({library:i,version:e})),"VERSION"))}const z="firebase-heartbeat-database",G=1,H="firebase-heartbeat-store";let K=null;function Q(){return K||(K=function(t,e){let{blocked:n,upgrade:r,blocking:s,terminated:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(t,e),a=y(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(y(o.result),t.oldVersion,t.newVersion,y(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(z,G,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(H)}catch(n){console.warn(n)}}}).catch((t=>{throw P.create("idb-open",{originalErrorMessage:t.message})}))),K}async function W(t,e){try{const n=(await Q()).transaction(H,"readwrite"),r=n.objectStore(H);await r.put(e,X(t)),await n.done}catch(n){if(n instanceof i.ZR)I.warn(n.message);else{const t=P.create("idb-set",{originalErrorMessage:null===n||void 0===n?void 0:n.message});I.warn(t.message)}}}function X(t){return"".concat(t.name,"!").concat(t.options.appId)}class Y{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Z(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){try{var t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=J();var e;if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(n){I.warn(n)}}async getHeartbeatsHeader(){try{var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=J(),{heartbeatsToSend:n,unsentEntries:r}=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),$(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),$(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=(0,i.L)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return I.warn(e),""}}}function J(){return(new Date).toISOString().substring(0,10)}class Z{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,i.hl)()&&(0,i.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Q()).transaction(H),n=await e.objectStore(H).get(X(t));return await e.done,n}catch(e){if(e instanceof i.ZR)I.warn(e.message);else{const t=P.create("idb-get",{originalErrorMessage:null===e||void 0===e?void 0:e.message});I.warn(t.message)}}}(this.app);return null!==t&&void 0!==t&&t.heartbeats?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){if(await this._canUseIndexedDBPromise){var e;const n=await this.read();return W(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function $(t){return(0,i.L)(JSON.stringify({version:2,heartbeats:t})).length}var tt;tt="",O(new r.wA("platform-logger",(t=>new T(t)),"PRIVATE")),O(new r.wA("heartbeat",(t=>new Y(t)),"PRIVATE")),q(S,C,tt),q(S,C,"esm2020"),q("fire-js","")},5726:(t,e,n)=>{n.d(e,{H0:()=>a,wA:()=>s});var r=n(2030);class s{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const i="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(n){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null===t||void 0===t?void 0:t.identifier),r=null!==(e=null===t||void 0===t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error("Mismatching Component ".concat(t.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(const[t,n]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:r});n.resolve(t)}catch(e){}}}}clearInstance(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.instances.has(t)}getOptions(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.instancesOptions.get(t)||{}}initialize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error("".concat(this.name,"(").concat(n,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[s,i]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(s)&&i.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch{}}getOrInitializeService(t){let{instanceIdentifier:e,options:n={}}=t,r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(s=e,s===i?void 0:s),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}var s;return r||null}normalizeInstanceIdentifier(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i;return this.component?this.component.multipleInstances?t:i:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component ".concat(t.name," has already been registered with ").concat(this.name));e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},510:(t,e,n)=>{n.d(e,{Yd:()=>u,in:()=>s});const r=[];var s;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(s||(s={}));const i={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},c=function(t,e){if(e<t.logLevel)return;const n=(new Date).toISOString(),r=a[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(e,")"));for(var s=arguments.length,i=new Array(s>2?s-2:0),o=2;o<s;o++)i[o-2]=arguments[o];console[r]("[".concat(n,"]  ").concat(t.name,":"),...i)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in s))throw new TypeError('Invalid value "'.concat(t,'" assigned to `logLevel`'));this._logLevel=t}setLogLevel(t){this._logLevel="string"===typeof t?i[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!==typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}},4702:(t,e,n)=>{n.d(e,{ZF:()=>r.ZF});var r=n(7949);(0,r.KN)("firebase","12.6.0","app")},7478:(t,e,n)=>{n.d(e,{hJ:()=>$a,JU:()=>tc,QT:()=>eu,PL:()=>ru,ad:()=>ic,nP:()=>cu,IO:()=>jc,pl:()=>su,r7:()=>iu,ar:()=>zc});var r,s,i=n(7949),o=n(5726),a=n(510),c=n(2030),u="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},h={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function n(t,e,n){n||(n=0);const r=Array(16);if("string"===typeof e)for(var s=0;s<16;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;s<16;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];let i,o=t.g[3];i=e+(o^n&(s^o))+r[0]+3614090360&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[1]+3905402710&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[2]+606105819&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[3]+3250441966&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[4]+4118548399&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[5]+1200080426&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[6]+2821735955&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[7]+4249261313&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[8]+1770035416&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[9]+2336552879&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[10]+4294925233&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[11]+2304563134&4294967295,i=e+(o^(n=s+(i<<22&4294967295|i>>>10))&(s^o))+r[12]+1804603682&4294967295,i=o+(s^(e=n+(i<<7&4294967295|i>>>25))&(n^s))+r[13]+4254626195&4294967295,o=e+(i<<12&4294967295|i>>>20),i=s+(n^o&(e^n))+r[14]+2792965006&4294967295,i=n+(e^(s=o+(i<<17&4294967295|i>>>15))&(o^e))+r[15]+1236535329&4294967295,i=e+(s^o&((n=s+(i<<22&4294967295|i>>>10))^s))+r[1]+4129170786&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[6]+3225465664&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[11]+643717713&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[0]+3921069994&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[5]+3593408605&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[10]+38016083&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[15]+3634488961&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[4]+3889429448&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[9]+568446438&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[14]+3275163606&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[3]+4107603335&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[8]+1163531501&4294967295,i=e+(s^o&((n=s+(i<<20&4294967295|i>>>12))^s))+r[13]+2850285829&4294967295,i=o+(n^s&((e=n+(i<<5&4294967295|i>>>27))^n))+r[2]+4243563512&4294967295,o=e+(i<<9&4294967295|i>>>23),i=s+(e^n&(o^e))+r[7]+1735328473&4294967295,i=n+(o^e&((s=o+(i<<14&4294967295|i>>>18))^o))+r[12]+2368359562&4294967295,i=e+((n=s+(i<<20&4294967295|i>>>12))^s^o)+r[5]+4294588738&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[8]+2272392833&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[11]+1839030562&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[14]+4259657740&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[1]+2763975236&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[4]+1272893353&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[7]+4139469664&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[10]+3200236656&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[13]+681279174&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[0]+3936430074&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[3]+3572445317&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[6]+76029189&4294967295,i=e+((n=s+(i<<23&4294967295|i>>>9))^s^o)+r[9]+3654602809&4294967295,i=o+((e=n+(i<<4&4294967295|i>>>28))^n^s)+r[12]+3873151461&4294967295,o=e+(i<<11&4294967295|i>>>21),i=s+(o^e^n)+r[15]+530742520&4294967295,i=n+((s=o+(i<<16&4294967295|i>>>16))^o^e)+r[2]+3299628645&4294967295,i=e+(s^((n=s+(i<<23&4294967295|i>>>9))|~o))+r[0]+4096336452&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[7]+1126891415&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[14]+2878612391&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[5]+4237533241&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[12]+1700485571&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[3]+2399980690&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[10]+4293915773&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[1]+2240044497&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[8]+1873313359&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[15]+4264355552&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[6]+2734768916&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[13]+1309151649&4294967295,i=e+(s^((n=s+(i<<21&4294967295|i>>>11))|~o))+r[4]+4149444226&4294967295,i=o+(n^((e=n+(i<<6&4294967295|i>>>26))|~s))+r[11]+3174756917&4294967295,o=e+(i<<10&4294967295|i>>>22),i=s+(e^(o|~n))+r[2]+718787259&4294967295,i=n+(o^((s=o+(i<<15&4294967295|i>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(i<<21&4294967295|i>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+o&4294967295}function i(t,e){this.h=e;const n=[];let r=!0;for(let s=t.length-1;s>=0;s--){const i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.F=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.D=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}(e,(function(){this.blockSize=-1})),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(t,e){void 0===e&&(e=t.length);const r=e-this.blockSize,s=this.C;let i=this.h,o=0;for(;o<e;){if(0==i)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"===typeof t){for(;o<e;)if(s[i++]=t.charCodeAt(o++),i==this.blockSize){n(this,s),i=0;break}}else for(;o<e;)if(s[i++]=t[o++],i==this.blockSize){n(this,s),i=0;break}}this.h=i,this.o+=e},e.prototype.A=function(){var t=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;e=8*this.o;for(var n=t.length-8;n<t.length;++n)t[n]=255&e,e/=256;for(this.v(t),t=Array(16),e=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)t[e++]=this.g[n]>>>r&255;return t};var o={};function a(t){return-128<=t&&t<128?function(t,e){var n=o;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(t){return new i([0|t],t<0?-1:0)})):new i([0|t],t<0?-1:0)}function c(t){if(isNaN(t)||!isFinite(t))return u;if(t<0)return p(c(-t));const e=[];let n=1;for(let r=0;t>=n;r++)e[r]=t/n|0,n*=4294967296;return new i(e,0)}var u=a(0),l=a(1),d=a(16777216);function f(t){if(0!=t.h)return!1;for(let e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function g(t){return-1==t.h}function p(t){const e=t.g.length,n=[];for(let r=0;r<e;r++)n[r]=~t.g[r];return new i(n,~t.h).add(l)}function m(t,e){return t.add(p(e))}function y(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function v(t,e){this.g=t,this.h=e}function w(t,e){if(f(e))throw Error("division by zero");if(f(t))return new v(u,u);if(g(t))return e=w(p(t),e),new v(p(e.g),p(e.h));if(g(e))return e=w(t,p(e)),new v(p(e.g),e.h);if(t.g.length>30){if(g(t)||g(e))throw Error("slowDivide_ only works with positive integers.");for(var n=l,r=e;r.l(t)<=0;)n=E(n),r=E(r);var s=_(n,1),i=_(r,1);for(r=_(r,2),n=_(n,2);!f(r);){var o=i.add(r);o.l(t)<=0&&(s=s.add(n),i=o),r=_(r,1),n=_(n,1)}return e=m(t,s.j(e)),new v(s,e)}for(s=u;t.l(e)>=0;){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=(r=Math.ceil(Math.log(n)/Math.LN2))<=48?1:Math.pow(2,r-48),o=(i=c(n)).j(e);g(o)||o.l(t)>0;)o=(i=c(n-=r)).j(e);f(i)&&(i=l),s=s.add(i),t=m(t,o)}return new v(s,t)}function E(t){const e=t.g.length+1,n=[];for(let r=0;r<e;r++)n[r]=t.i(r)<<1|t.i(r-1)>>>31;return new i(n,t.h)}function _(t,e){const n=e>>5;e%=32;const r=t.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=e>0?t.i(i+n)>>>e|t.i(i+n+1)<<32-e:t.i(i+n);return new i(s,t.h)}(t=i.prototype).m=function(){if(g(this))return-p(this).m();let t=0,e=1;for(let n=0;n<this.g.length;n++){const r=this.i(n);t+=(r>=0?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if(f(this))return"0";if(g(this))return"-"+p(this).toString(t);const e=c(Math.pow(t,6));var n=this;let r="";for(;;){const s=w(n,e).g;let i=(((n=m(n,s.j(e))).g.length>0?n.g[0]:n.h)>>>0).toString(t);if(f(n=s))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},t.i=function(t){return t<0?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return g(t=m(this,t))?-1:f(t)?0:1},t.abs=function(){return g(this)?p(this):this},t.add=function(t){const e=Math.max(this.g.length,t.g.length),n=[];let r=0;for(let s=0;s<=e;s++){let e=r+(65535&this.i(s))+(65535&t.i(s)),i=(e>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);r=i>>>16,e&=65535,i&=65535,n[s]=i<<16|e}return new i(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(f(this)||f(t))return u;if(g(this))return g(t)?p(this).j(p(t)):p(p(this).j(t));if(g(t))return p(this.j(p(t)));if(this.l(d)<0&&t.l(d)<0)return c(this.m()*t.m());const e=this.g.length+t.g.length,n=[];for(var r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let e=0;e<t.g.length;e++){const s=this.i(r)>>>16,i=65535&this.i(r),o=t.i(e)>>>16,a=65535&t.i(e);n[2*r+2*e]+=i*a,y(n,2*r+2*e),n[2*r+2*e+1]+=s*a,y(n,2*r+2*e+1),n[2*r+2*e+1]+=i*o,y(n,2*r+2*e+1),n[2*r+2*e+2]+=s*o,y(n,2*r+2*e+2)}for(t=0;t<e;t++)n[t]=n[2*t+1]<<16|n[2*t];for(t=e;t<2*e;t++)n[t]=0;return new i(n,0)},t.B=function(t){return w(this,t).h},t.and=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)&t.i(r);return new i(n,this.h&t.h)},t.or=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)|t.i(r);return new i(n,this.h|t.h)},t.xor=function(t){const e=Math.max(this.g.length,t.g.length),n=[];for(let r=0;r<e;r++)n[r]=this.i(r)^t.i(r);return new i(n,this.h^t.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,s=h.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=c,i.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return p(t(e.substring(1),n));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=c(Math.pow(n,8));let s=u;for(let o=0;o<e.length;o+=8){var i=Math.min(8,e.length-o);const t=parseInt(e.substring(o,o+i),n);i<8?(i=c(Math.pow(n,i)),s=s.j(i).add(c(t))):(s=s.j(r),s=s.add(c(t)))}return s},r=h.Integer=i}).apply("undefined"!==typeof u?u:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var l,d,f,g,p,m,y,v,w="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},E={};(function(){var t,e=Object.defineProperty;var n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof w&&w];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function r(t,r){if(r)t:{var s=n;t=t.split(".");for(var i=0;i<t.length-1;i++){var o=t[i];if(!(o in s))break t;s=s[o]}(r=r(i=s[t=t[t.length-1]]))!=i&&null!=r&&e(s,t,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",(function(t){return t||Symbol("Symbol.dispose")})),r("Array.prototype.values",(function(t){return t||function(){return this[Symbol.iterator]()}})),r("Object.entries",(function(t){return t||function(t){var e,n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push([e,t[e]]);return n}}));var s=s||{},i=this||self;function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){return(c=a).apply(null,arguments)}function u(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function h(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Ob=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}var _="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?t=>t&&AsyncContext.Snapshot.wrap(t):t=>t;function T(t){const e=t.length;if(e>0){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function S(t,e){for(let r=1;r<arguments.length;r++){const e=arguments[r];var n=typeof e;if("array"==(n="object"!=n?n:e?Array.isArray(e)?"array":n:"null")||"object"==n&&"number"==typeof e.length){n=t.length||0;const r=e.length||0;t.length=n+r;for(let s=0;s<r;s++)t[n+s]=e[s]}else t.push(e)}}function C(t){i.setTimeout((()=>{throw t}),0)}function I(){var t=R;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var A=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return this.h>0?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new D),(t=>t.reset()));class D{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let N,k=!1,R=new class{constructor(){this.h=this.g=null}add(t,e){const n=A.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},x=()=>{const t=Promise.resolve(void 0);N=()=>{t.then(O)}};function O(){for(var t;t=I();){try{t.h.call(t.g)}catch(n){C(n)}var e=A;e.j(t),e.h<100&&(e.h++,t.next=e.g,e.g=t)}k=!1}function L(){this.u=this.u,this.C=this.C}function M(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}L.prototype.u=!1,L.prototype.dispose=function(){this.u||(this.u=!0,this.N())},L.prototype[Symbol.dispose]=function(){this.dispose()},L.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},M.prototype.h=function(){this.defaultPrevented=!0};var V=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(n){}return t}();function P(t){return/^[\s\xa0]*$/.test(t)}function F(t,e){M.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t&&this.init(t,e)}h(F,M),F.prototype.init=function(t,e){const n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;this.target=t.target||t.srcElement,this.g=e,(e=t.relatedTarget)||("mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement)),this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=t.pointerType,this.state=t.state,this.i=t,t.defaultPrevented&&F.Z.h.call(this)},F.prototype.h=function(){F.Z.h.call(this);const t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var U="closure_listenable_"+(1e6*Math.random()|0),B=0;function j(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=s,this.key=++B,this.da=this.fa=!1}function q(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function z(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function G(t){const e={};for(const n in t)e[n]=t[n];return e}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function K(t,e){let n,r;for(let s=1;s<arguments.length;s++){for(n in r=arguments[s],r)t[n]=r[n];for(let e=0;e<H.length;e++)n=H[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Q(t){this.src=t,this.g={},this.h=0}function W(t,e){const n=e.type;if(n in t.g){var r,s=t.g[n],i=Array.prototype.indexOf.call(s,e,void 0);(r=i>=0)&&Array.prototype.splice.call(s,i,1),r&&(q(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function X(t,e,n,r){for(let s=0;s<t.length;++s){const i=t[s];if(!i.da&&i.listener==e&&i.capture==!!n&&i.ha==r)return s}return-1}Q.prototype.add=function(t,e,n,r,s){const i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);const o=X(t,e,r,s);return o>-1?(e=t[o],n||(e.fa=!1)):((e=new j(e,this.src,i,!!r,s)).fa=n,t.push(e)),e};var Y="closure_lm_"+(1e6*Math.random()|0),J={};function Z(t,e,n,r,s){if(r&&r.once)return et(t,e,n,r,s);if(Array.isArray(e)){for(let i=0;i<e.length;i++)Z(t,e[i],n,r,s);return null}return n=ct(n),t&&t[U]?t.J(e,n,o(r)?!!r.capture:!!r,s):$(t,e,n,!1,r,s)}function $(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");const a=o(s)?!!s.capture:!!s;let c=ot(t);if(c||(t[Y]=c=new Q(t)),(n=c.add(e,n,r,a,i)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=it;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)V||(s=a),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(st(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function et(t,e,n,r,s){if(Array.isArray(e)){for(let i=0;i<e.length;i++)et(t,e[i],n,r,s);return null}return n=ct(n),t&&t[U]?t.K(e,n,o(r)?!!r.capture:!!r,s):$(t,e,n,!0,r,s)}function nt(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)nt(t,e[i],n,r,s);else r=o(r)?!!r.capture:!!r,n=ct(n),t&&t[U]?(t=t.i,(i=String(e).toString())in t.g&&((n=X(e=t.g[i],n,r,s))>-1&&(q(e[n]),Array.prototype.splice.call(e,n,1),0==e.length&&(delete t.g[i],t.h--)))):t&&(t=ot(t))&&(e=t.g[e.toString()],t=-1,e&&(t=X(e,n,r,s)),(n=t>-1?e[t]:null)&&rt(n))}function rt(t){if("number"!==typeof t&&t&&!t.da){var e=t.src;if(e&&e[U])W(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(st(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=ot(e))?(W(n,t),0==n.h&&(n.src=null,e[Y]=null)):q(t)}}}function st(t){return t in J?J[t]:J[t]="on"+t}function it(t,e){if(t.da)t=!0;else{e=new F(e,this);const n=t.listener,r=t.ha||t.src;t.fa&&rt(t),t=n.call(r,e)}return t}function ot(t){return(t=t[Y])instanceof Q?t:null}var at="__closure_events_fn_"+(1e9*Math.random()>>>0);function ct(t){return"function"===typeof t?t:(t[at]||(t[at]=function(e){return t.handleEvent(e)}),t[at])}function ut(){L.call(this),this.i=new Q(this),this.M=this,this.G=null}function ht(t,e){var n,r=t.G;if(r)for(n=[];r;r=r.G)n.push(r);if(t=t.M,r=e.type||e,"string"===typeof e)e=new M(e,t);else if(e instanceof M)e.target=e.target||t;else{var s=e;K(e=new M(r,t),s)}let i,o;if(s=!0,n)for(o=n.length-1;o>=0;o--)i=e.g=n[o],s=lt(i,r,!0,e)&&s;if(i=e.g=t,s=lt(i,r,!0,e)&&s,s=lt(i,r,!1,e)&&s,n)for(o=0;o<n.length;o++)i=e.g=n[o],s=lt(i,r,!1,e)&&s}function lt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();let s=!0;for(let i=0;i<e.length;++i){const o=e[i];if(o&&!o.da&&o.capture==n){const e=o.listener,n=o.ha||o.src;o.fa&&W(t.i,o),s=!1!==e.call(n,r)&&s}}return s&&!r.defaultPrevented}function dt(t){t.g=function(t,e){if("function"!==typeof t){if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=c(t.handleEvent,t)}return Number(e)>2147483647?-1:i.setTimeout(t,e||0)}((()=>{t.g=null,t.i&&(t.i=!1,dt(t))}),t.l);const e=t.h;t.h=null,t.m.apply(null,e)}h(ut,L),ut.prototype[U]=!0,ut.prototype.removeEventListener=function(t,e,n,r){nt(this,t,e,n,r)},ut.prototype.N=function(){if(ut.Z.N.call(this),this.i){var t=this.i;for(const e in t.g){const n=t.g[e];for(let t=0;t<n.length;t++)q(n[t]);delete t.g[e],t.h--}}this.G=null},ut.prototype.J=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},ut.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class ft extends L{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:dt(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gt(t){L.call(this),this.h=t,this.g={}}h(gt,L);var pt=[];function mt(t){z(t.g,(function(t,e){this.g.hasOwnProperty(e)&&rt(t)}),t),t.g={}}gt.prototype.N=function(){gt.Z.N.call(this),mt(this)},gt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var yt=i.JSON.stringify,vt=i.JSON.parse,wt=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function Et(){}function _t(){}var bt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Tt(){M.call(this,"d")}function St(){M.call(this,"c")}h(Tt,M),h(St,M);var Ct={},It=null;function At(){return It=It||new ut}function Dt(t){M.call(this,Ct.Ia,t)}function Nt(t){const e=At();ht(e,new Dt(e))}function kt(t,e){M.call(this,Ct.STAT_EVENT,t),this.stat=e}function Rt(t){const e=At();ht(e,new kt(e,t))}function xt(t,e){M.call(this,Ct.Ja,t),this.size=e}function Ot(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout((function(){t()}),e)}function Lt(){this.g=!0}function Mt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{const i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var n=i[t];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(let t=1;t<r.length;t++)r[t]=""}}}return yt(i)}catch(i){return e}}(t,n)+(r?" "+r:"")}))}Ct.Ia="serverreachability",h(Dt,M),Ct.STAT_EVENT="statevent",h(kt,M),Ct.Ja="timingevent",h(xt,M),Lt.prototype.ua=function(){this.g=!1},Lt.prototype.info=function(){};var Vt,Pt={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Ft={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ut(){}function Bt(t){return encodeURIComponent(String(t))}function jt(t){var e=1;t=t.split(":");const n=[];for(;e>0&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function qt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.S=r||1,this.V=new gt(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new zt}function zt(){this.i=null,this.g="",this.h=!1}h(Ut,Et),Ut.prototype.g=function(){return new XMLHttpRequest},Vt=new Ut;var Gt={},Ht={};function Kt(t,e,n){t.M=1,t.A=ye(de(e)),t.u=n,t.R=!0,Qt(t,null)}function Qt(t,e){t.F=Date.now(),Yt(t),t.B=de(t.A);var n=t.B,r=t.S;Array.isArray(r)||(r=[String(r)]),Re(n.i,"t",r),t.C=0,n=t.j.L,t.h=new zt,t.g=vn(t.j,n?e:null,!t.u),t.P>0&&(t.O=new ft(c(t.Y,t,t.g),t.P)),e=t.V,n=t.g,r=t.ba;var s="readystatechange";Array.isArray(s)||(s&&(pt[0]=s.toString()),s=pt);for(let i=0;i<s.length;i++){const t=Z(n,s[i],r||e.handleEvent,!1,e.h||e);if(!t)break;e.g[t.key]=t}e=t.J?G(t.J):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.B,t.v,t.u,e)):(t.v="GET",t.g.ea(t.B,t.v,null,e)),Nt(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i){var o="",a=i.split("&");for(let t=0;t<a.length;t++){var c=a[t].split("=");if(c.length>1){const t=c[0];c=c[1];const e=t.split("_");o=e.length>=2&&"type"==e[1]?o+(t+"=")+c+"&":o+(t+"=redacted&")}}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.i,t.v,t.B,t.l,t.S,t.u)}function Wt(t){return!!t.g&&("GET"==t.v&&2!=t.M&&t.j.Aa)}function Xt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ht:(n=Number(e.substring(n,r)),isNaN(n)?Gt:(r+=1)+n>e.length?Ht:(e=e.slice(r,r+n),t.C=r+n,e))}function Yt(t){t.T=Date.now()+t.H,Jt(t,t.H)}function Jt(t,e){if(null!=t.D)throw Error("WatchDog timer not null");t.D=Ot(c(t.aa,t),e)}function Zt(t){t.D&&(i.clearTimeout(t.D),t.D=null)}function $t(t){0==t.j.I||t.K||fn(t.j,t)}function te(t){Zt(t);var e=t.O;e&&"function"==typeof e.dispose&&e.dispose(),t.O=null,mt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.dispose())}function ee(t,e){try{var n=t.j;if(0!=n.I&&(n.g==t||oe(n.h,t)))if(!t.L&&oe(n.h,t)&&3==n.I){try{var r=n.Ba.g.parse(e)}catch(h){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.v){if(n.g){if(!(n.g.F+3e3<t.F))break t;dn(n),en(n)}un(n),Rt(18)}}else n.xa=s[1],0<n.xa-n.K&&s[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=Ot(c(n.Va,n),6e3));ie(n.h)<=1&&n.ta&&(n.ta=void 0)}else pn(n,11)}else if((t.L||n.g==t)&&dn(n),!P(e))for(s=n.Ba.g.parse(e),e=0;e<s.length;e++){let c=s[e];const h=c[0];if(!(h<=n.K))if(n.K=h,c=c[1],2==n.I)if("c"==c[0]){n.M=c[1],n.ba=c[2];const e=c[3];null!=e&&(n.ka=e,n.j.info("VER="+n.ka));const s=c[4];null!=s&&(n.za=s,n.j.info("SVER="+n.za));const h=c[5];null!=h&&"number"===typeof h&&h>0&&(r=1.5*h,n.O=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.h;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(ae(i,i.h),i.h=null))}if(r.G){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.wa=t,me(r.J,r.G,t))}}n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-t.F,n.j.info("Handshake RTT: "+n.T+"ms"));var o=t;if((r=n).na=yn(r,r.L?r.ba:null,r.W),o.L){ce(r.h,o);var a=o,u=r.O;u&&(a.H=u),a.D&&(Zt(a),Yt(a)),r.g=o}else cn(r);n.i.length>0&&rn(n)}else"stop"!=c[0]&&"close"!=c[0]||pn(n,7);else 3==n.I&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?pn(n,7):tn(n):"noop"!=c[0]&&n.l&&n.l.qa(c),n.A=0)}Nt()}catch(h){}}qt.prototype.ba=function(t){t=t.target;const e=this.O;e&&3==Ye(t)?e.j():this.Y(t)},qt.prototype.Y=function(t){try{if(t==this.g)t:{const c=Ye(this.g),u=this.g.ya();this.g.ca();if(!(c<3)&&(3!=c||this.g&&(this.h.h||this.g.la()||Je(this.g)))){this.K||4!=c||7==u||Nt(),Zt(this);var e=this.g.ca();this.X=e;var n=function(t){if(!Wt(t))return t.g.la();const e=Je(t.g);if(""===e)return"";let n="";const r=e.length,s=4==Ye(t.g);if(!t.h.i){if("undefined"===typeof TextDecoder)return te(t),$t(t),"";t.h.i=new i.TextDecoder}for(let i=0;i<r;i++)t.h.h=!0,n+=t.h.i.decode(e[i],{stream:!(s&&i==r-1)});return e.length=0,t.h.g+=n,t.C=0,t.h.g}(this);if(this.o=200==e,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.i,this.v,this.B,this.l,this.S,c,e),this.o){if(this.U&&!this.L){e:{if(this.g){var r,s=this.g;if((r=s.g?s.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(r)){var o=r;break e}}o=null}if(!(t=o)){this.o=!1,this.m=3,Rt(12),te(this),$t(this);break t}Mt(this.i,this.l,t,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ee(this,t)}if(this.R){let e;for(t=!0;!this.K&&this.C<n.length;){if(e=Xt(this,n),e==Ht){4==c&&(this.m=4,Rt(14),t=!1),Mt(this.i,this.l,null,"[Incomplete Response]");break}if(e==Gt){this.m=4,Rt(15),Mt(this.i,this.l,n,"[Invalid Chunk]"),t=!1;break}Mt(this.i,this.l,e,null),ee(this,e)}if(Wt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=n.length||this.h.h||(this.m=1,Rt(16),t=!1),this.o=this.o&&t,t){if(n.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),hn(a),a.P=!0,Rt(11))}}else Mt(this.i,this.l,n,"[Invalid Chunked Response]"),te(this),$t(this)}else Mt(this.i,this.l,n,null),ee(this,n);4==c&&te(this),this.o&&!this.K&&(4==c?fn(this.j,this):(this.o=!1,Yt(this)))}else(function(t){const e={};t=(t.g&&Ye(t)>=2&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(P(t[r]))continue;var n=jt(t[r]);const s=n[0];if("string"!==typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==e&&n.indexOf("Unknown SID")>0?(this.m=3,Rt(12)):(this.m=0,Rt(13)),te(this),$t(this)}}}catch(tt){}},qt.prototype.cancel=function(){this.K=!0,te(this)},qt.prototype.aa=function(){this.D=null;const t=Date.now();t-this.T>=0?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.i,this.B),2!=this.M&&(Nt(),Rt(17)),te(this),this.m=2,$t(this)):Jt(this,this.T-t)};var ne=class{constructor(t,e){this.g=t,this.map=e}};function re(t){this.l=t||10,i.PerformanceNavigationTiming?t=(t=i.performance.getEntriesByType("navigation")).length>0&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function se(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ie(t){return t.h?1:t.g?t.g.size:0}function oe(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ae(t,e){t.g?t.g.add(e):t.h=e}function ce(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ue(t){if(null!=t.h)return t.i.concat(t.h.G);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.G);return e}return T(t.i)}re.prototype.cancel=function(){if(this.i=ue(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var he=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function le(t){let e;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,t instanceof le?(this.l=t.l,fe(this,t.j),this.o=t.o,this.g=t.g,ge(this,t.u),this.h=t.h,pe(this,xe(t.i)),this.m=t.m):t&&(e=String(t).match(he))?(this.l=!1,fe(this,e[1]||"",!0),this.o=ve(e[2]||""),this.g=ve(e[3]||"",!0),ge(this,e[4]),this.h=ve(e[5]||"",!0),pe(this,e[6]||"",!0),this.m=ve(e[7]||"")):(this.l=!1,this.i=new Ie(null,this.l))}function de(t){return new le(t)}function fe(t,e,n){t.j=n?ve(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ge(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.u=e}else t.u=null}function pe(t,e,n){e instanceof Ie?(t.i=e,function(t,e){e&&!t.j&&(Ae(t),t.i=null,t.g.forEach((function(t,e){const n=e.toLowerCase();e!=n&&(De(this,e),Re(this,n,t))}),t)),t.j=e}(t.i,t.l)):(n||(e=we(e,Se)),t.i=new Ie(e,t.l))}function me(t,e,n){t.i.set(e,n)}function ye(t){return me(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ve(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function we(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Ee),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ee(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}le.prototype.toString=function(){const t=[];var e=this.j;e&&t.push(we(e,_e,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(we(e,_e,!0),"@"),t.push(Bt(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&t.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(we(n,"/"==n.charAt(0)?Te:be,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",we(n,Ce)),t.join("")},le.prototype.resolve=function(t){const e=de(this);let n=!!t.j;n?fe(e,t.j):n=!!t.o,n?e.o=t.o:n=!!t.g,n?e.g=t.g:n=null!=t.u;var r=t.h;if(n)ge(e,t.u);else if(n=!!t.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var s=e.h.lastIndexOf("/");-1!=s&&(r=e.h.slice(0,s+1)+r)}if(".."==(s=r)||"."==s)r="";else if(-1!=s.indexOf("./")||-1!=s.indexOf("/.")){r=0==s.lastIndexOf("/",0),s=s.split("/");const t=[];for(let e=0;e<s.length;){const n=s[e++];"."==n?r&&e==s.length&&t.push(""):".."==n?((t.length>1||1==t.length&&""!=t[0])&&t.pop(),r&&e==s.length&&t.push("")):(t.push(n),r=!0)}r=t.join("/")}else r=s}return n?e.h=r:n=""!==t.i.toString(),n?pe(e,xe(t.i)):n=!!t.m,n&&(e.m=t.m),e};var _e=/[#\/\?@]/g,be=/[#\?:]/g,Te=/[#\?]/g,Se=/[#\?@]/g,Ce=/#/g;function Ie(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ae(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(let n=0;n<t.length;n++){const r=t[n].indexOf("=");let s,i=null;r>=0?(s=t[n].substring(0,r),i=t[n].substring(r+1)):s=t[n],e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function De(t,e){Ae(t),e=Oe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Ne(t,e){return Ae(t),e=Oe(t,e),t.g.has(e)}function ke(t,e){Ae(t);let n=[];if("string"===typeof e)Ne(t,e)&&(n=n.concat(t.g.get(Oe(t,e))));else for(t=Array.from(t.g.values()),e=0;e<t.length;e++)n=n.concat(t[e]);return n}function Re(t,e,n){De(t,e),n.length>0&&(t.i=null,t.g.set(Oe(t,e),T(n)),t.h+=n.length)}function xe(t){const e=new Ie;return e.i=t.i,t.g&&(e.g=new Map(t.g),e.h=t.h),e}function Oe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Le(t,e,n,r,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),r(n)}catch(i){}}function Me(){this.g=new wt}function Ve(t){this.i=t.Sb||null,this.h=t.ab||!1}function Pe(t,e){ut.call(this),this.H=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Fe(t){t.j.read().then(t.Ma.bind(t)).catch(t.ga.bind(t))}function Ue(t){t.readyState=4,t.l=null,t.j=null,t.B=null,Be(t)}function Be(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function je(t){let e="";return z(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function qe(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=je(n),"string"===typeof t?null!=n&&Bt(n):me(t,e,n))}function ze(t){ut.call(this),this.headers=new Map,this.L=t||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=Ie.prototype).add=function(t,e){Ae(this),this.i=null,t=Oe(this,t);let n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Ae(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},t.set=function(t,e){return Ae(this),this.i=null,Ne(this,t=Oe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&(t=ke(this,t)).length>0?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(let r=0;r<e.length;r++){var n=e[r];const s=Bt(n);n=ke(this,n);for(let e=0;e<n.length;e++){let r=s;""!==n[e]&&(r+="="+Bt(n[e])),t.push(r)}}return this.i=t.join("&")},h(Ve,Et),Ve.prototype.g=function(){return new Pe(this.i,this.h)},h(Pe,ut),(t=Pe.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=t,this.D=e,this.readyState=1,Be(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const e={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};t&&(e.body=t),(this.H||i).fetch(new Request(this.D,e)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ue(this)),this.readyState=0},t.Pa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Be(this)),this.g&&(this.readyState=3,Be(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Fe(this)}else t.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.B.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ue(this):Be(this),3==this.readyState&&Fe(this)}},t.Oa=function(t){this.g&&(this.response=this.responseText=t,Ue(this))},t.Na=function(t){this.g&&(this.response=t,Ue(this))},t.ga=function(){this.g&&Ue(this)},t.setRequestHeader=function(t,e){this.A.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Pe.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),h(ze,ut);var Ge=/^https?$/i,He=["POST","PUT"];function Ke(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.o=5,Qe(t),Xe(t)}function Qe(t){t.A||(t.A=!0,ht(t,"complete"),ht(t,"error"))}function We(t){if(t.h&&"undefined"!=typeof s)if(t.v&&4==Ye(t))setTimeout(t.Ca.bind(t),0);else if(ht(t,"readystatechange"),4==Ye(t)){t.h=!1;try{const s=t.ca();t:switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===s){let e=String(t.D).match(he)[1]||null;!e&&i.self&&i.self.location&&(e=i.self.location.protocol.slice(0,-1)),r=!Ge.test(e?e.toLowerCase():"")}n=r}if(n)ht(t,"complete"),ht(t,"success");else{t.o=6;try{var o=Ye(t)>2?t.g.statusText:""}catch(a){o=""}t.l=o+" ["+t.ca()+"]",Qe(t)}}finally{Xe(t)}}}function Xe(t,e){if(t.g){t.m&&(clearTimeout(t.m),t.m=null);const r=t.g;t.g=null,e||ht(t,"ready");try{r.onreadystatechange=null}catch(n){}}}function Ye(t){return t.g?t.g.readyState:0}function Je(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.F){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Ze(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function $e(t){this.za=0,this.i=[],this.j=new Lt,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ze("failFast",!1,t),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ze("baseRetryDelayMs",5e3,t),this.Za=Ze("retryDelaySeedMs",1e4,t),this.Ta=Ze("forwardChannelMaxRetries",2,t),this.va=Ze("forwardChannelRequestTimeoutMs",2e4,t),this.ma=t&&t.xmlHttpFactory||void 0,this.Ua=t&&t.Rb||void 0,this.Aa=t&&t.useFetchStreams||!1,this.O=void 0,this.L=t&&t.supportsCrossDomainXhr||!1,this.M="",this.h=new re(t&&t.concurrentRequestLimit),this.Ba=new Me,this.S=t&&t.fastHandshake||!1,this.R=t&&t.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=t&&t.Pb||!1,t&&t.ua&&this.j.ua(),t&&t.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&t&&t.detectBufferingProxy||!1,this.ia=void 0,t&&t.longPollingTimeout&&t.longPollingTimeout>0&&(this.ia=t.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tn(t){if(nn(t),3==t.I){var e=t.V++,n=de(t.J);if(me(n,"SID",t.M),me(n,"RID",e),me(n,"TYPE","terminate"),on(t,n),(e=new qt(t,t.j,e)).M=2,e.A=ye(de(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.A.toString(),"")}catch(r){}!n&&i.Image&&((new Image).src=e.A,n=!0),n||(e.g=vn(e.j,null),e.g.ea(e.A)),e.F=Date.now(),Yt(e)}mn(t)}function en(t){t.g&&(hn(t),t.g.cancel(),t.g=null)}function nn(t){en(t),t.v&&(i.clearTimeout(t.v),t.v=null),dn(t),t.h.cancel(),t.m&&("number"===typeof t.m&&i.clearTimeout(t.m),t.m=null)}function rn(t){if(!se(t.h)&&!t.m){t.m=!0;var e=t.Ea;N||x(),k||(N(),k=!0),R.add(e,t),t.D=0}}function sn(t,e){var n;n=e?e.l:t.V++;const r=de(t.J);me(r,"SID",t.M),me(r,"RID",n),me(r,"AID",t.K),on(t,r),t.u&&t.o&&qe(r,t.u,t.o),n=new qt(t,t.j,n,t.D+1),null===t.u&&(n.J=t.o),e&&(t.i=e.G.concat(t.i)),e=an(t,n,1e3),n.H=Math.round(.5*t.va)+Math.round(.5*t.va*Math.random()),ae(t.h,n),Kt(n,r,e)}function on(t,e){t.H&&z(t.H,(function(t,n){me(e,n,t)})),t.l&&z({},(function(t,n){me(e,n,t)}))}function an(t,e,n){n=Math.min(t.i.length,n);const r=t.l?c(t.l.Ka,t.l,t):null;t:{var s=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?n>0?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let c=!0;for(let u=0;u<n;u++){var i=s[u].g;const n=s[u].map;if((i-=e)<0)e=Math.max(0,s[u].g-100),c=!1;else try{i="req"+i+"_"||0;try{var a=n instanceof Map?n:Object.entries(n);for(const[e,n]of a){let r=n;o(n)&&(r=yt(n)),t.push(i+e+"="+encodeURIComponent(r))}}catch(b){throw t.push(i+"type="+encodeURIComponent("_badmap")),b}}catch(b){r&&r(n)}}if(c){a=t.join("&");break t}}a=void 0}return t=t.i.splice(0,n),e.G=t,a}function cn(t){if(!t.g&&!t.v){t.Y=1;var e=t.Da;N||x(),k||(N(),k=!0),R.add(e,t),t.A=0}}function un(t){return!(t.g||t.v||t.A>=3)&&(t.Y++,t.v=Ot(c(t.Da,t),gn(t,t.A)),t.A++,!0)}function hn(t){null!=t.B&&(i.clearTimeout(t.B),t.B=null)}function ln(t){t.g=new qt(t,t.j,"rpc",t.Y),null===t.u&&(t.g.J=t.o),t.g.P=0;var e=de(t.na);me(e,"RID","rpc"),me(e,"SID",t.M),me(e,"AID",t.K),me(e,"CI",t.F?"0":"1"),!t.F&&t.ia&&me(e,"TO",t.ia),me(e,"TYPE","xmlhttp"),on(t,e),t.u&&t.o&&qe(e,t.u,t.o),t.O&&(t.g.H=t.O);var n=t.g;t=t.ba,n.M=1,n.A=ye(de(e)),n.u=null,n.R=!0,Qt(n,t)}function dn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function fn(t,e){var n=null;if(t.g==e){dn(t),hn(t),t.g=null;var r=2}else{if(!oe(t.h,e))return;n=e.G,ce(t.h,e),r=1}if(0!=t.I)if(e.o)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.F;var s=t.D;ht(r=At(),new xt(r,n)),rn(t)}else cn(t);else if(3==(s=e.m)||0==s&&e.X>0||!(1==r&&function(t,e){return!(ie(t.h)>=t.h.j-(t.m?1:0))&&(t.m?(t.i=e.G.concat(t.i),!0):!(1==t.I||2==t.I||t.D>=(t.Sa?0:t.Ta))&&(t.m=Ot(c(t.Ea,t,e),gn(t,t.D)),t.D++,!0))}(t,e)||2==r&&un(t)))switch(n&&n.length>0&&(e=t.h,e.i=e.i.concat(n)),s){case 1:pn(t,5);break;case 4:pn(t,10);break;case 3:pn(t,6);break;default:pn(t,2)}}function gn(t,e){let n=t.Qa+Math.floor(Math.random()*t.Za);return t.isActive()||(n*=2),n*e}function pn(t,e){if(t.j.info("Error code "+e),2==e){var n=c(t.bb,t),r=t.Ua;const e=!r;r=new le(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||fe(r,"https"),ye(r),e?function(t,e){const n=new Lt;if(i.Image){const r=new Image;r.onload=u(Le,n,"TestLoadImage: loaded",!0,e,r),r.onerror=u(Le,n,"TestLoadImage: error",!1,e,r),r.onabort=u(Le,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=u(Le,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new Lt;const n=new AbortController,r=setTimeout((()=>{n.abort(),Le(0,0,!1,e)}),1e4);fetch(t,{signal:n.signal}).then((t=>{clearTimeout(r),t.ok?Le(0,0,!0,e):Le(0,0,!1,e)})).catch((()=>{clearTimeout(r),Le(0,0,!1,e)}))}(r.toString(),n)}else Rt(2);t.I=0,t.l&&t.l.pa(e),mn(t),nn(t)}function mn(t){if(t.I=0,t.ja=[],t.l){const e=ue(t.h);0==e.length&&0==t.i.length||(S(t.ja,e),S(t.ja,t.i),t.h.i.length=0,T(t.i),t.i.length=0),t.l.oa()}}function yn(t,e,n){var r=n instanceof le?de(n):new le(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ge(r,r.u);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;const t=new le(null);r&&fe(t,r),e&&(t.g=e),s&&ge(t,s),n&&(t.h=n),r=t}return n=t.G,e=t.wa,n&&e&&me(r,n,e),me(r,"VER",t.ka),on(t,r),r}function vn(t,e,n){if(e&&!t.L)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Aa&&!t.ma?new ze(new Ve({ab:n})):new ze(t.ma)).Fa(t.L),e}function wn(){}function En(){}function _n(t,e){ut.call(this),this.g=new $e(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.sa&&(t?t["X-WebChannel-Client-Profile"]=e.sa:t={"X-WebChannel-Client-Profile":e.sa}),this.g.U=t,(t=e&&e.Qb)&&!P(t)&&(this.g.u=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!P(e)&&(this.g.G=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Sn(this)}function bn(t){Tt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Tn(){St.call(this),this.status=1}function Sn(t){this.g=t}(t=ze.prototype).Fa=function(t){this.H=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Vt.g(),this.g.onreadystatechange=_(c(this.Ca,this));try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(o){return void Ke(this,o)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=i.FormData&&t instanceof i.FormData,!(Array.prototype.indexOf.call(He,e,void 0)>=0)||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,a]of n)this.g.setRequestHeader(i,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(o){Ke(this,o)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=t||7,ht(this,"complete"),ht(this,"abort"),Xe(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Xe(this,!0)),ze.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?We(this):this.Xa())},t.Xa=function(){We(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return Ye(this)>2?this.g.status:-1}catch(t){return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.La=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),vt(e)}},t.ya=function(){return this.o},t.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(t=$e.prototype).ka=8,t.I=1,t.connect=function(t,e,n,r){Rt(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=yn(this,null,this.W),rn(this)},t.Ea=function(t){if(this.m)if(this.m=null,1==this.I){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const s=new qt(this,this.j,t);let i=this.o;if(this.U&&(i?(i=G(i),K(i,this.U)):i=this.U),null!==this.u||this.R||(s.J=i,i=null),this.S)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"===typeof(r=r.map.__data__)?r.length:void 0))break;if((e+=r)>4096){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=an(this,s,e),me(n=de(this.J),"RID",t),me(n,"CVER",22),this.G&&me(n,"X-HTTP-Session-Id",this.G),on(this,n),i&&(this.R?e="headers="+Bt(je(i))+"&"+e:this.u&&qe(n,this.u,i)),ae(this.h,s),this.Ra&&me(n,"TYPE","init"),this.S?(me(n,"$req",e),me(n,"SID","null"),s.U=!0,Kt(s,n,null)):Kt(s,n,e),this.I=2}}else 3==this.I&&(t?sn(this,t):0==this.i.length||se(this.h)||sn(this))},t.Da=function(){if(this.v=null,ln(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var t=4*this.T;this.j.info("BP detection timer enabled: "+t),this.B=Ot(c(this.Wa,this),t)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Rt(10),en(this),ln(this))},t.Va=function(){null!=this.C&&(this.C=null,en(this),un(this),Rt(19))},t.bb=function(t){t?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=wn.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},En.prototype.g=function(t,e){return new _n(t,e)},h(_n,ut),_n.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},_n.prototype.close=function(){tn(this.g)},_n.prototype.o=function(t){var e=this.g;if("string"===typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=yt(t),t=n);e.i.push(new ne(e.Ya++,t)),3==e.I&&rn(e)},_n.prototype.N=function(){this.g.l=null,delete this.j,tn(this.g),delete this.g,_n.Z.N.call(this)},h(bn,Tt),h(Tn,St),h(Sn,wn),Sn.prototype.ra=function(){ht(this.g,"a")},Sn.prototype.qa=function(t){ht(this.g,new bn(t))},Sn.prototype.pa=function(t){ht(this.g,new Tn)},Sn.prototype.oa=function(){ht(this.g,"b")},En.prototype.createWebChannel=En.prototype.g,_n.prototype.send=_n.prototype.o,_n.prototype.open=_n.prototype.m,_n.prototype.close=_n.prototype.close,v=E.createWebChannelTransport=function(){return new En},y=E.getStatEventTarget=function(){return At()},m=E.Event=Ct,p=E.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Pt.NO_ERROR=0,Pt.TIMEOUT=8,Pt.HTTP_ERROR=6,g=E.ErrorCode=Pt,Ft.COMPLETE="complete",f=E.EventType=Ft,_t.EventType=bt,bt.OPEN="a",bt.CLOSE="b",bt.ERROR="c",bt.MESSAGE="d",ut.prototype.listen=ut.prototype.J,d=E.WebChannel=_t,E.FetchXmlHttpFactory=Ve,ze.prototype.listenOnce=ze.prototype.K,ze.prototype.getLastError=ze.prototype.Ha,ze.prototype.getLastErrorCode=ze.prototype.ya,ze.prototype.getStatus=ze.prototype.ca,ze.prototype.getResponseJson=ze.prototype.La,ze.prototype.getResponseText=ze.prototype.la,ze.prototype.send=ze.prototype.ea,ze.prototype.setWithCredentials=ze.prototype.Fa,l=E.XhrIo=ze}).apply("undefined"!==typeof w?w:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const _="@firebase/firestore",b="4.9.2";class T{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}T.UNAUTHENTICATED=new T(null),T.GOOGLE_CREDENTIALS=new T("google-credentials-uid"),T.FIRST_PARTY=new T("first-party-uid"),T.MOCK_USER=new T("mock-user");let S="12.3.0";const C=new a.Yd("@firebase/firestore");function I(){return C.logLevel}function A(t){if(C.logLevel<=a.in.DEBUG){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(k);C.debug("Firestore (".concat(S,"): ").concat(t),...s)}}function D(t){if(C.logLevel<=a.in.ERROR){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(k);C.error("Firestore (".concat(S,"): ").concat(t),...s)}}function N(t){if(C.logLevel<=a.in.WARN){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];const s=n.map(k);C.warn("Firestore (".concat(S,"): ").concat(t),...s)}}function k(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function R(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,x(t,r,n)}function x(t,e,n){let r="FIRESTORE (".concat(S,") INTERNAL ASSERTION FAILED: ").concat(e," (ID: ").concat(t.toString(16),")");if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw D(r),new Error(r)}function O(t,e,n,r){let s="Unexpected state";"string"==typeof n?s=n:r=n,t||x(e,s,r)}function L(t,e){return t}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends c.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class P{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class F{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))}}class U{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(T.UNAUTHENTICATED)))}shutdown(){}}class B{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class j{constructor(t){this.t=t,this.currentUser=T.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){O(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new P;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new P,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{A("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(A("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new P)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(A("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(O("string"==typeof e.accessToken,31837,{l:e}),new F(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return O(null===t||"string"==typeof t,2055,{h:t}),new T(t)}}class q{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=T.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class z{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new q(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(T.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class G{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class H{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,i.rh)(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){O(void 0===this.o,3512);const n=t=>{null!=t.error&&A("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(t.error.message));const n=t.token!==this.m;return this.m=t.token,A("FirebaseAppCheckTokenProvider","Received ".concat(n?"new":"existing"," token.")),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{A("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):A("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new G(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(O("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new G(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function K(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}class Q{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=K(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function W(t,e){return t<e?-1:t>e?1:0}function X(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.charAt(r),s=e.charAt(r);if(n!==s)return Z(n)===Z(s)?W(n,s):Z(n)?1:-1}return W(t.length,e.length)}const Y=55296,J=57343;function Z(t){const e=t.charCodeAt(0);return e>=Y&&e<=J}function $(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}const tt="__name__";class et{constructor(t,e,n){void 0===e?e=0:e>t.length&&R(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&R(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===et.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof et?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=et.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return W(t.length,e.length)}static compareSegments(t,e){const n=et.isNumericId(t),r=et.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?et.extractNumericId(t).compare(et.extractNumericId(e)):X(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return r.fromString(t.substring(4,t.length-2))}}class nt extends et{construct(t,e,n){return new nt(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const t=[];for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n){if(s.indexOf("//")>=0)throw new V(M.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));t.push(...s.split("/").filter((t=>t.length>0)))}return new nt(t)}static emptyPath(){return new nt([])}}const rt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class st extends et{construct(t,e,n){return new st(t,e,n)}static isValidIdentifier(t){return rt.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),st.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tt}static keyField(){return new st([tt])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new V(M.INVALID_ARGUMENT,"Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new V(M.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new V(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new V(M.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new st(e)}static emptyPath(){return new st([])}}class it{constructor(t){this.path=t}static fromPath(t){return new it(nt.fromString(t))}static fromName(t){return new it(nt.fromString(t).popFirst(5))}static empty(){return new it(nt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===nt.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return nt.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new it(new nt(t.slice()))}}function ot(t,e,n){if(!n)throw new V(M.INVALID_ARGUMENT,"Function ".concat(t,"() cannot be called with an empty ").concat(e,"."))}function at(t){if(!it.isDocumentKey(t))throw new V(M.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(t," has ").concat(t.length,"."))}function ct(t){if(it.isDocumentKey(t))throw new V(M.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(t," has ").concat(t.length,"."))}function ut(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ht(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t="".concat(t.substring(0,20),"...")),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?"a custom ".concat(e," object"):"an object"}}return"function"==typeof t?"a function":R(12329,{type:typeof t})}function lt(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new V(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ht(t);throw new V(M.INVALID_ARGUMENT,"Expected type '".concat(e.name,"', but it was: ").concat(n))}}return t}function dt(t,e){const n={typeString:t};return e&&(n.value=e),n}function ft(t,e){if(!ut(t))throw new V(M.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n="JSON missing required field: '".concat(r,"'");break}const o=t[r];if(s&&typeof o!==s){n="JSON field '".concat(r,"' must be a ").concat(s,".");break}if(void 0!==i&&o!==i.value){n="Expected '".concat(r,"' field to equal '").concat(i.value,"'");break}}if(n)throw new V(M.INVALID_ARGUMENT,n);return!0}const gt=-62135596800,pt=1e6;class mt{static now(){return mt.fromMillis(Date.now())}static fromDate(t){return mt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*pt);return new mt(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<gt)throw new V(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/pt}_compareTo(t){return this.seconds===t.seconds?W(this.nanoseconds,t.nanoseconds):W(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:mt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ft(t,mt._jsonSchema))return new mt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-gt;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}mt._jsonSchemaVersion="firestore/timestamp/1.0",mt._jsonSchema={type:dt("string",mt._jsonSchemaVersion),seconds:dt("number"),nanoseconds:dt("number")};class yt{static fromTimestamp(t){return new yt(t)}static min(){return new yt(new mt(0,0))}static max(){return new yt(new mt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const vt=-1;class wt{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}wt.UNKNOWN_ID=-1;function Et(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=yt.fromTimestamp(1e9===r?new mt(n+1,0):new mt(n,r));return new bt(s,it.empty(),e)}function _t(t){return new bt(t.readTime,t.key,vt)}class bt{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new bt(yt.min(),it.empty(),vt)}static max(){return new bt(yt.max(),it.empty(),vt)}}function Tt(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=it.comparator(t.documentKey,e.documentKey),0!==n?n:W(t.largestBatchId,e.largestBatchId))}const St="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ct{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function It(t){if(t.code!==M.FAILED_PRECONDITION||t.message!==St)throw t;A("LocalStore","Unexpectedly lost primary lease")}class At{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&R(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new At(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof At?e:At.resolve(e)}catch(t){return At.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):At.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):At.reject(e)}static resolve(t){return new At(((e,n)=>{e(t)}))}static reject(t){return new At(((e,n)=>{n(t)}))}static waitFor(t){return new At(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=At.resolve(!1);for(const n of t)e=e.next((t=>t?At.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new At(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;e(t[c]).next((t=>{i[c]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new At(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}function Dt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Nt(t){return"IndexedDbTransactionError"===t.name}class kt{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ae(t),this.ue=t=>e.writeSequenceNumber(t))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}kt.ce=-1;const Rt=-1;function xt(t){return null==t}function Ot(t){return 0===t&&1/t==-1/0}function Lt(t){return"number"==typeof t&&Number.isInteger(t)&&!Ot(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const Mt="\x01";function Vt(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ft(e)),e=Pt(t.get(n),e);return Ft(e)}function Pt(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const e=t.charAt(s);switch(e){case"\0":n+="\x01\x10";break;case Mt:n+="\x01\x11";break;default:n+=e}}return n}function Ft(t){return t+Mt+"\x01"}const Ut="remoteDocuments",Bt="owner",jt="mutationQueues",qt="mutations";const zt="documentMutations",Gt="remoteDocumentsV14",Ht="remoteDocumentGlobal",Kt="targets",Qt="targetDocuments",Wt="targetGlobal",Xt="collectionParents",Yt="clientMetadata",Jt="bundles",Zt="namedQueries",$t="indexConfiguration",te="indexState",ee="indexEntries",ne="documentOverlays",re="globals",se=[jt,qt,zt,Ut,Kt,Bt,Wt,Qt,Yt,Ht,Xt,Jt,Zt],ie=[jt,qt,zt,Gt,Kt,Bt,Wt,Qt,Yt,Ht,Xt,Jt,Zt,ne],oe=ie,ae=[...oe,$t,te,ee];function ce(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ue(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function he(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class le{constructor(t,e){this.comparator=t,this.root=e||fe.EMPTY}insert(t,e){return new le(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,fe.BLACK,null,null))}remove(t){return new le(this.comparator,this.root.remove(t,this.comparator).copy(null,null,fe.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push("".concat(e,":").concat(n)),!1))),"{".concat(t.join(", "),"}")}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new de(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new de(this.root,t,this.comparator,!1)}getReverseIterator(){return new de(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new de(this.root,t,this.comparator,!0)}}class de{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class fe{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:fe.RED,this.left=null!=r?r:fe.EMPTY,this.right=null!=s?s:fe.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new fe(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return fe.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return fe.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,fe.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,fe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw R(43730,{key:this.key,value:this.value});if(this.right.isRed())throw R(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw R(27949);return t+(this.isRed()?0:1)}}fe.EMPTY=null,fe.RED=!0,fe.BLACK=!1,fe.EMPTY=new class{constructor(){this.size=0}get key(){throw R(57766)}get value(){throw R(16141)}get color(){throw R(16727)}get left(){throw R(29726)}get right(){throw R(36894)}copy(t,e,n,r,s){return this}insert(t,e,n){return new fe(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ge{constructor(t){this.comparator=t,this.data=new le(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new pe(this.data.getIterator())}getIteratorFrom(t){return new pe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof ge))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ge(this.comparator);return e.data=t,e}}class pe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class me{constructor(t){this.fields=t,t.sort(st.comparator)}static empty(){return new me([])}unionWith(t){let e=new ge(st.comparator);for(const n of this.fields)e=e.add(n);for(const n of t)e=e.add(n);return new me(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return $(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class ye extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class ve{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new ye("Invalid base64 string: "+t):t}}(t);return new ve(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ve(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return W(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ve.EMPTY_BYTE_STRING=new ve("");const we=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ee(t){if(O(!!t,39018),"string"==typeof t){let e=0;const n=we.exec(t);if(O(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:_e(t.seconds),nanos:_e(t.nanos)}}function _e(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function be(t){return"string"==typeof t?ve.fromBase64String(t):ve.fromUint8Array(t)}const Te="server_timestamp",Se="__type__",Ce="__previous_value__",Ie="__local_write_time__";function Ae(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Se])||void 0===e?void 0:e.stringValue)===Te}function De(t){const e=t.mapValue.fields[Ce];return Ae(e)?De(e):e}function Ne(t){const e=Ee(t.mapValue.fields[Ie].timestampValue);return new mt(e.seconds,e.nanos)}class ke{constructor(t,e,n,r,s,i,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Re="(default)";class xe{constructor(t,e){this.projectId=t,this.database=e||Re}static empty(){return new xe("","")}get isDefaultDatabase(){return this.database===Re}isEqual(t){return t instanceof xe&&t.projectId===this.projectId&&t.database===this.database}}const Oe="__type__",Le="__max__",Me={mapValue:{fields:{__type__:{stringValue:Le}}}},Ve="__vector__",Pe="value";function Fe(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ae(t)?4:en(t)?9007199254740991:$e(t)?10:11:R(28295,{value:t})}function Ue(t,e){if(t===e)return!0;const n=Fe(t);if(n!==Fe(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ne(t).isEqual(Ne(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Ee(t.timestampValue),r=Ee(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return be(t.bytesValue).isEqual(be(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return _e(t.geoPointValue.latitude)===_e(e.geoPointValue.latitude)&&_e(t.geoPointValue.longitude)===_e(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return _e(t.integerValue)===_e(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=_e(t.doubleValue),r=_e(e.doubleValue);return n===r?Ot(n)===Ot(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return $(t.arrayValue.values||[],e.arrayValue.values||[],Ue);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ce(n)!==ce(r))return!1;for(const s in n)if(n.hasOwnProperty(s)&&(void 0===r[s]||!Ue(n[s],r[s])))return!1;return!0}(t,e);default:return R(52216,{left:t})}}function Be(t,e){return void 0!==(t.values||[]).find((t=>Ue(t,e)))}function je(t,e){if(t===e)return 0;const n=Fe(t),r=Fe(e);if(n!==r)return W(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return W(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=_e(t.integerValue||t.doubleValue),r=_e(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return qe(t.timestampValue,e.timestampValue);case 4:return qe(Ne(t),Ne(e));case 5:return X(t.stringValue,e.stringValue);case 6:return function(t,e){const n=be(t),r=be(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let s=0;s<n.length&&s<r.length;s++){const t=W(n[s],r[s]);if(0!==t)return t}return W(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=W(_e(t.latitude),_e(e.latitude));return 0!==n?n:W(_e(t.longitude),_e(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return ze(t.arrayValue,e.arrayValue);case 10:return function(t,e,n,r,s,i){const o=t.fields||{},a=e.fields||{},c=null===(n=o[Pe])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Pe])||void 0===r?void 0:r.arrayValue,h=W((null===c||void 0===c||null===(s=c.values)||void 0===s?void 0:s.length)||0,(null===u||void 0===u||null===(i=u.values)||void 0===i?void 0:i.length)||0);return 0!==h?h:ze(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===Me.mapValue&&e===Me.mapValue)return 0;if(t===Me.mapValue)return 1;if(e===Me.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let o=0;o<r.length&&o<i.length;++o){const t=X(r[o],i[o]);if(0!==t)return t;const e=je(n[r[o]],s[i[o]]);if(0!==e)return e}return W(r.length,i.length)}(t.mapValue,e.mapValue);default:throw R(23264,{he:n})}}function qe(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return W(t,e);const n=Ee(t),r=Ee(e),s=W(n.seconds,r.seconds);return 0!==s?s:W(n.nanos,r.nanos)}function ze(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const t=je(n[s],r[s]);if(t)return t}return W(n.length,r.length)}function Ge(t){return He(t)}function He(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Ee(t);return"time(".concat(e.seconds,",").concat(e.nanos,")")}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return be(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return it.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return"geo(".concat(t.latitude,",").concat(t.longitude,")")}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=He(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+="".concat(s,":").concat(He(t.fields[s]));return n+"}"}(t.mapValue):R(61005,{value:t})}function Ke(t){switch(Fe(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=De(t);return e?16+Ke(e):16;case 5:return 2*t.stringValue.length;case 6:return be(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce(((t,e)=>t+Ke(e)),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return ue(t.fields,((t,n)=>{e+=t.length+Ke(n)})),e}(t.mapValue);default:throw R(13486,{value:t})}}function Qe(t,e){return{referenceValue:"projects/".concat(t.projectId,"/databases/").concat(t.database,"/documents/").concat(e.path.canonicalString())}}function We(t){return!!t&&"integerValue"in t}function Xe(t){return!!t&&"arrayValue"in t}function Ye(t){return!!t&&"nullValue"in t}function Je(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ze(t){return!!t&&"mapValue"in t}function $e(t){var e,n;return(null===(e=((null===t||void 0===t||null===(n=t.mapValue)||void 0===n?void 0:n.fields)||{})[Oe])||void 0===e?void 0:e.stringValue)===Ve}function tn(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return ue(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=tn(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=tn(t.arrayValue.values[n]);return e}return{...t}}function en(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===Le}class nn{constructor(t){this.value=t}static empty(){return new nn({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Ze(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=tn(e)}setAll(t){let e=st.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=tn(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());Ze(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ue(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Ze(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){ue(e,((e,n)=>t[e]=n));for(const r of n)delete t[r]}clone(){return new nn(tn(this.value))}}function rn(t){const e=[];return ue(t.fields,((t,n)=>{const r=new st([t]);if(Ze(n)){const t=rn(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new me(e)}class sn{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new sn(t,0,yt.min(),yt.min(),yt.min(),nn.empty(),0)}static newFoundDocument(t,e,n,r){return new sn(t,1,e,yt.min(),n,r,0)}static newNoDocument(t,e){return new sn(t,2,e,yt.min(),yt.min(),nn.empty(),0)}static newUnknownDocument(t,e){return new sn(t,3,e,yt.min(),yt.min(),nn.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(yt.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=nn.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=nn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=yt.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof sn&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new sn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class on{constructor(t,e){this.position=t,this.inclusive=e}}function an(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?it.comparator(it.fromName(o.referenceValue),n.key):je(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function cn(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ue(t.position[n],e.position[n]))return!1;return!0}class un{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=t,this.dir=e}}function hn(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ln{}class dn extends ln{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new En(t,e,n):"array-contains"===e?new Sn(t,n):"in"===e?new Cn(t,n):"not-in"===e?new In(t,n):"array-contains-any"===e?new An(t,n):new dn(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new _n(t,n):new bn(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(je(e,this.value)):null!==e&&Fe(this.value)===Fe(e)&&this.matchesComparison(je(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return R(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class fn extends ln{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new fn(t,e)}matches(t){return gn(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function gn(t){return"and"===t.op}function pn(t){return mn(t)&&gn(t)}function mn(t){for(const e of t.filters)if(e instanceof fn)return!1;return!0}function yn(t){if(t instanceof dn)return t.field.canonicalString()+t.op.toString()+Ge(t.value);if(pn(t))return t.filters.map((t=>yn(t))).join(",");{const e=t.filters.map((t=>yn(t))).join(",");return"".concat(t.op,"(").concat(e,")")}}function vn(t,e){return t instanceof dn?function(t,e){return e instanceof dn&&t.op===e.op&&t.field.isEqual(e.field)&&Ue(t.value,e.value)}(t,e):t instanceof fn?function(t,e){return e instanceof fn&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&vn(n,e.filters[r])),!0)}(t,e):void R(19439)}function wn(t){return t instanceof dn?function(t){return"".concat(t.field.canonicalString()," ").concat(t.op," ").concat(Ge(t.value))}(t):t instanceof fn?function(t){return t.op.toString()+" {"+t.getFilters().map(wn).join(" ,")+"}"}(t):"Filter"}class En extends dn{constructor(t,e,n){super(t,e,n),this.key=it.fromName(n.referenceValue)}matches(t){const e=it.comparator(t.key,this.key);return this.matchesComparison(e)}}class _n extends dn{constructor(t,e){super(t,"in",e),this.keys=Tn("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class bn extends dn{constructor(t,e){super(t,"not-in",e),this.keys=Tn("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Tn(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>it.fromName(t.referenceValue)))}class Sn extends dn{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Xe(e)&&Be(e.arrayValue,this.value)}}class Cn extends dn{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Be(this.value.arrayValue,e)}}class In extends dn{constructor(t,e){super(t,"not-in",e)}matches(t){if(Be(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Be(this.value.arrayValue,e)}}class An extends dn{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Xe(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Be(this.value.arrayValue,t)))}}class Dn{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.Te=null}}function Nn(t){return new Dn(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function kn(t){const e=L(t);if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>yn(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),xt(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Ge(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Ge(t))).join(",")),e.Te=t}return e.Te}function Rn(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!hn(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!vn(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cn(t.startAt,e.startAt)&&cn(t.endAt,e.endAt)}function xn(t){return it.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class On{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ln(t,e,n,r,s,i,o,a){return new On(t,e,n,r,s,i,o,a)}function Mn(t){return new On(t)}function Vn(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Pn(t){return null!==t.collectionGroup}function Fn(t){const e=L(t);if(null===e.Ie){e.Ie=[];const t=new Set;for(const s of e.explicitOrderBy)e.Ie.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new ge(st.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ie.push(new un(r,n))})),t.has(st.keyField().canonicalString())||e.Ie.push(new un(st.keyField(),n))}return e.Ie}function Un(t){const e=L(t);return e.Ee||(e.Ee=Bn(e,Fn(t))),e.Ee}function Bn(t,e){if("F"===t.limitType)return Nn(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new un(t.field,e)}));const n=t.endAt?new on(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new on(t.startAt.position,t.startAt.inclusive):null;return Nn(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function jn(t,e){const n=t.filters.concat([e]);return new On(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function qn(t,e,n){return new On(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zn(t,e){return Rn(Un(t),Un(e))&&t.limitType===e.limitType}function Gn(t){return"".concat(kn(Un(t)),"|lt:").concat(t.limitType)}function Hn(t){return"Query(target=".concat(function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: [".concat(t.filters.map((t=>wn(t))).join(", "),"]")),xt(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: [".concat(t.orderBy.map((t=>function(t){return"".concat(t.field.canonicalString()," (").concat(t.dir,")")}(t))).join(", "),"]")),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Ge(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Ge(t))).join(",")),"Target(".concat(e,")")}(Un(t)),"; limitType=").concat(t.limitType,")")}function Kn(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):it.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Fn(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=an(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Fn(t),e))&&!(t.endAt&&!function(t,e,n){const r=an(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Fn(t),e))}(t,e)}function Qn(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Wn(t){return(e,n)=>{let r=!1;for(const s of Fn(t)){const t=Xn(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function Xn(t,e,n){const r=t.field.isKeyField()?it.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?je(r,s):R(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return R(19790,{direction:t.dir})}}class Yn{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[r,s]of n)if(this.equalsFn(r,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return void(r[s]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){ue(this.inner,((e,n)=>{for(const[r,s]of n)t(r,s)}))}isEmpty(){return he(this.inner)}size(){return this.innerSize}}const Jn=new le(it.comparator);function Zn(){return Jn}const $n=new le(it.comparator);function tr(){let t=$n;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n)t=t.insert(s.key,s);return t}function er(t){let e=$n;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function nr(){return sr()}function rr(){return sr()}function sr(){return new Yn((t=>t.toString()),((t,e)=>t.isEqual(e)))}const ir=new le(it.comparator),or=new ge(it.comparator);function ar(){let t=or;for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];for(const s of n)t=t.add(s);return t}const cr=new ge(W);function ur(){return cr}function hr(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ot(e)?"-0":e}}function lr(t){return{integerValue:""+t}}function dr(t,e){return Lt(e)?lr(e):hr(t,e)}class fr{constructor(){this._=void 0}}function gr(t,e,n){return t instanceof yr?function(t,e){const n={fields:{[Se]:{stringValue:Te},[Ie]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ae(e)&&(e=De(e)),e&&(n.fields[Ce]=e),{mapValue:n}}(n,e):t instanceof vr?wr(t,e):t instanceof Er?_r(t,e):function(t,e){const n=mr(t,e),r=Tr(n)+Tr(t.Ae);return We(n)&&We(t.Ae)?lr(r):hr(t.serializer,r)}(t,e)}function pr(t,e,n){return t instanceof vr?wr(t,e):t instanceof Er?_r(t,e):n}function mr(t,e){return t instanceof br?function(t){return We(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class yr extends fr{}class vr extends fr{constructor(t){super(),this.elements=t}}function wr(t,e){const n=Sr(e);for(const r of t.elements)n.some((t=>Ue(t,r)))||n.push(r);return{arrayValue:{values:n}}}class Er extends fr{constructor(t){super(),this.elements=t}}function _r(t,e){let n=Sr(e);for(const r of t.elements)n=n.filter((t=>!Ue(t,r)));return{arrayValue:{values:n}}}class br extends fr{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Tr(t){return _e(t.integerValue||t.doubleValue)}function Sr(t){return Xe(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Cr{constructor(t,e){this.field=t,this.transform=e}}class Ir{constructor(t,e){this.version=t,this.transformResults=e}}class Ar{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ar}static exists(t){return new Ar(void 0,t)}static updateTime(t){return new Ar(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Dr(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Nr{}function kr(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Br(t.key,Ar.none()):new Mr(t.key,t.data,Ar.none());{const n=t.data,r=nn.empty();let s=new ge(st.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new Vr(t.key,r,new me(s.toArray()),Ar.none())}}function Rr(t,e,n){t instanceof Mr?function(t,e,n){const r=t.value.clone(),s=Fr(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Vr?function(t,e,n){if(!Dr(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Fr(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Pr(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function xr(t,e,n,r){return t instanceof Mr?function(t,e,n,r){if(!Dr(t.precondition,e))return n;const s=t.value.clone(),i=Ur(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof Vr?function(t,e,n,r){if(!Dr(t.precondition,e))return n;const s=Ur(t.fieldTransforms,r,e),i=e.data;return i.setAll(Pr(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Dr(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Or(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),s=mr(r.transform,t||null);null!=s&&(null===n&&(n=nn.empty()),n.set(r.field,s))}return n||null}function Lr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&$(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof vr&&e instanceof vr||t instanceof Er&&e instanceof Er?$(t.elements,e.elements,Ue):t instanceof br&&e instanceof br?Ue(t.Ae,e.Ae):t instanceof yr&&e instanceof yr}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Mr extends Nr{constructor(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Vr extends Nr{constructor(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Pr(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Fr(t,e,n){const r=new Map;O(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,pr(o,a,n[s]))}return r}function Ur(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,gr(t,i,e))}return r}class Br extends Nr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jr extends Nr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class qr{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let r=0;r<this.mutations.length;r++){const e=this.mutations[r];e.key.isEqual(t.key)&&Rr(e,t,n[r])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=xr(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=xr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=rr();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=kr(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(yt.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ar())}isEqual(t){return this.batchId===t.batchId&&$(this.mutations,t.mutations,((t,e)=>Lr(t,e)))&&$(this.baseMutations,t.baseMutations,((t,e)=>Lr(t,e)))}}class zr{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){O(t.mutations.length===n.length,58842,{me:t.mutations.length,fe:n.length});let r=ir;const s=t.mutations;for(let i=0;i<s.length;i++)r=r.insert(s[i].key,n[i].version);return new zr(t,e,n,r)}}class Gr{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Hr{constructor(t,e){this.count=t,this.unchangedNames=e}}var Kr,Qr;function Wr(t){switch(t){case M.OK:return R(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return R(15467,{code:t})}}function Xr(t){if(void 0===t)return D("GRPC error has no .code"),M.UNKNOWN;switch(t){case Kr.OK:return M.OK;case Kr.CANCELLED:return M.CANCELLED;case Kr.UNKNOWN:return M.UNKNOWN;case Kr.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case Kr.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case Kr.INTERNAL:return M.INTERNAL;case Kr.UNAVAILABLE:return M.UNAVAILABLE;case Kr.UNAUTHENTICATED:return M.UNAUTHENTICATED;case Kr.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case Kr.NOT_FOUND:return M.NOT_FOUND;case Kr.ALREADY_EXISTS:return M.ALREADY_EXISTS;case Kr.PERMISSION_DENIED:return M.PERMISSION_DENIED;case Kr.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case Kr.ABORTED:return M.ABORTED;case Kr.OUT_OF_RANGE:return M.OUT_OF_RANGE;case Kr.UNIMPLEMENTED:return M.UNIMPLEMENTED;case Kr.DATA_LOSS:return M.DATA_LOSS;default:return R(39323,{code:t})}}(Qr=Kr||(Kr={}))[Qr.OK=0]="OK",Qr[Qr.CANCELLED=1]="CANCELLED",Qr[Qr.UNKNOWN=2]="UNKNOWN",Qr[Qr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qr[Qr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qr[Qr.NOT_FOUND=5]="NOT_FOUND",Qr[Qr.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qr[Qr.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qr[Qr.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qr[Qr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qr[Qr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qr[Qr.ABORTED=10]="ABORTED",Qr[Qr.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qr[Qr.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qr[Qr.INTERNAL=13]="INTERNAL",Qr[Qr.UNAVAILABLE=14]="UNAVAILABLE",Qr[Qr.DATA_LOSS=15]="DATA_LOSS";let Yr=null;function Jr(){return new TextEncoder}const Zr=new r([4294967295,4294967295],0);function $r(t){const e=Jr().encode(t),n=new s;return n.update(e),new Uint8Array(n.digest())}function ts(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),s=e.getUint32(4,!0),i=e.getUint32(8,!0),o=e.getUint32(12,!0);return[new r([n,s],0),new r([i,o],0)]}class es{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ns("Invalid padding: ".concat(e));if(n<0)throw new ns("Invalid hash count: ".concat(n));if(t.length>0&&0===this.hashCount)throw new ns("Invalid hash count: ".concat(n));if(0===t.length&&0!==e)throw new ns("Invalid padding when bitmap length is 0: ".concat(e));this.ge=8*t.length-e,this.pe=r.fromNumber(this.ge)}ye(t,e,n){let s=t.add(e.multiply(r.fromNumber(n)));return 1===s.compare(Zr)&&(s=new r([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.ge)return!1;const e=$r(t),[n,r]=ts(e);for(let s=0;s<this.hashCount;s++){const t=this.ye(n,r,s);if(!this.we(t))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new es(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.ge)return;const e=$r(t),[n,r]=ts(e);for(let s=0;s<this.hashCount;s++){const t=this.ye(n,r,s);this.Se(t)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ns extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class rs{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ss.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new rs(yt.min(),r,new le(W),Zn(),ar())}}class ss{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ss(n,e,ar(),ar(),ar())}}class is{constructor(t,e,n,r){this.be=t,this.removedTargetIds=e,this.key=n,this.De=r}}class os{constructor(t,e){this.targetId=t,this.Ce=e}}class as{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ve.EMPTY_BYTE_STRING,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class cs{constructor(){this.ve=0,this.Fe=ls(),this.Me=ve.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=ar(),e=ar(),n=ar();return this.Fe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:R(38017,{changeType:s})}})),new ss(this.Me,this.xe,t,e,n)}qe(){this.Oe=!1,this.Fe=ls()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,O(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class us{constructor(t){this.Ge=t,this.ze=new Map,this.je=Zn(),this.Je=hs(),this.He=hs(),this.Ye=new le(W)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const n=this.nt(e);switch(t.state){case 0:this.rt(e)&&n.Le(t.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(t.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(n.We(),n.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),n.Le(t.resumeToken));break;default:R(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((t,n)=>{this.rt(n)&&e(n)}))}st(t){const e=t.targetId,n=t.Ce.count,r=this.ot(e);if(r){const i=r.target;if(xn(i))if(0===n){const t=new it(i.path);this.et(e,t,sn.newNoDocument(t,yt.min()))}else O(1===n,20013,{expectedCount:n});else{const r=this._t(e);if(r!==n){var s;const n=this.ut(t),i=n?this.ct(n,t,r):1;if(0!==i){this.it(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,t)}null===(s=Yr)||void 0===s||s.lt(function(t,e,n,r,s,i,o,a,c,u){const h={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},l=e.unchangedNames;return l&&(h.bloomFilter={applied:0===s,hashCount:null!==(i=null===l||void 0===l?void 0:l.hashCount)&&void 0!==i?i:0,bitmapLength:null!==(o=null===l||void 0===l||null===(a=l.bits)||void 0===a||null===(a=a.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(c=null===l||void 0===l||null===(u=l.bits)||void 0===u?void 0:u.padding)&&void 0!==c?c:0,mightContain:t=>{var e;return null!==(e=null===r||void 0===r?void 0:r.mightContain(t))&&void 0!==e&&e}}),h}(r,t.Ce,this.Ge.ht(),n,i))}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=be(n).toUint8Array()}catch(t){if(t instanceof ye)return N("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new es(i,r,s)}catch(t){return N(t instanceof ns?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.ge?null:o}ct(t,e,n){return e.Ce.count===n-this.Pt(t,e.targetId)?0:2}Pt(t,e){const n=this.Ge.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Ge.ht(),i="projects/".concat(s.projectId,"/databases/").concat(s.database,"/documents/").concat(n.path.canonicalString());t.mightContain(i)||(this.et(e,n,null),r++)})),r}Tt(t){const e=new Map;this.ze.forEach(((n,r)=>{const s=this.ot(r);if(s){if(n.current&&xn(s.target)){const e=new it(s.target.path);this.It(e).has(r)||this.Et(r,e)||this.et(r,e,sn.newNoDocument(e,t))}n.Be&&(e.set(r,n.ke()),n.qe())}}));let n=ar();this.He.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.ot(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.je.forEach(((e,n)=>n.setReadTime(t)));const r=new rs(t,e,this.Ye,this.je,n);return this.je=Zn(),this.Je=hs(),this.He=hs(),this.Ye=new le(W),r}Xe(t,e){if(!this.rt(t))return;const n=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,n),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,n){if(!this.rt(t))return;const r=this.nt(t);this.Et(t,e)?r.Qe(e,1):r.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),n&&(this.je=this.je.insert(e,n))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new cs,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new ge(W),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new ge(W),this.Je=this.Je.insert(t,e)),e}rt(t){const e=null!==this.ot(t);return e||A("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new cs),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function hs(){return new le(it.comparator)}function ls(){return new le(it.comparator)}const ds={asc:"ASCENDING",desc:"DESCENDING"},fs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gs={and:"AND",or:"OR"};class ps{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ms(t,e){return t.useProto3Json||xt(e)?e:{value:e}}function ys(t,e){return t.useProto3Json?"".concat(new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+e.nanoseconds).slice(-9),"Z"):{seconds:""+e.seconds,nanos:e.nanoseconds}}function vs(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ws(t,e){return ys(t,e.toTimestamp())}function Es(t){return O(!!t,49232),yt.fromTimestamp(function(t){const e=Ee(t);return new mt(e.seconds,e.nanos)}(t))}function _s(t,e){return bs(t,e).canonicalString()}function bs(t,e){const n=function(t){return new nt(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Ts(t){const e=nt.fromString(t);return O(zs(e),10190,{key:e.toString()}),e}function Ss(t,e){return _s(t.databaseId,e.path)}function Cs(t,e){const n=Ts(e);if(n.get(1)!==t.databaseId.projectId)throw new V(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new V(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new it(Ns(n))}function Is(t,e){return _s(t.databaseId,e)}function As(t){const e=Ts(t);return 4===e.length?nt.emptyPath():Ns(e)}function Ds(t){return new nt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ns(t){return O(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function ks(t,e,n){return{name:Ss(t,e),fields:n.value.mapValue.fields}}function Rs(t,e){let n;if(e instanceof Mr)n={update:ks(t,e.key,e.value)};else if(e instanceof Br)n={delete:Ss(t,e.key)};else if(e instanceof Vr)n={update:ks(t,e.key,e.data),updateMask:qs(e.fieldMask)};else{if(!(e instanceof jr))return R(16599,{Vt:e.type});n={verify:Ss(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof yr)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof vr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Er)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof br)return{fieldPath:e.field.canonicalString(),increment:n.Ae};throw R(20930,{transform:e.transform})}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ws(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:R(27497)}(t,e.precondition)),n}function xs(t,e){return{documents:[Is(t,e.path)]}}function Os(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Is(t,s);const i=function(t){if(0!==t.length)return js(fn.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Us(t.field),direction:Vs(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ms(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ft:n,parent:s}}function Ls(t){let e=As(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){O(1===r,65062);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=Ms(t);return e instanceof fn&&pn(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new un(Bs(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,xt(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new on(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new on(n,e)}(n.endAt)),Ln(e,s,o,i,a,"F",c,u)}function Ms(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Bs(t.unaryFilter.field);return dn.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Bs(t.unaryFilter.field);return dn.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Bs(t.unaryFilter.field);return dn.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Bs(t.unaryFilter.field);return dn.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return R(61313);default:return R(60726)}}(t):void 0!==t.fieldFilter?function(t){return dn.create(Bs(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return R(58110);default:return R(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return fn.create(t.compositeFilter.filters.map((t=>Ms(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return R(1026)}}(t.compositeFilter.op))}(t):R(30097,{filter:t})}function Vs(t){return ds[t]}function Ps(t){return fs[t]}function Fs(t){return gs[t]}function Us(t){return{fieldPath:t.canonicalString()}}function Bs(t){return st.fromServerFormat(t.fieldPath)}function js(t){return t instanceof dn?function(t){if("=="===t.op){if(Je(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NAN"}};if(Ye(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Je(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NAN"}};if(Ye(t.value))return{unaryFilter:{field:Us(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Us(t.field),op:Ps(t.op),value:t.value}}}(t):t instanceof fn?function(t){const e=t.getFilters().map((t=>js(t)));return 1===e.length?e[0]:{compositeFilter:{op:Fs(t.op),filters:e}}}(t):R(54877,{filter:t})}function qs(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function zs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Gs{constructor(t,e,n,r){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:yt.min(),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:yt.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:ve.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Gs(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Hs{constructor(t){this.yt=t}}function Ks(t){const e=Ls({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?qn(e,e.limit,"L"):e}class Qs{constructor(){}Dt(t,e){this.Ct(t,e),e.vt()}Ct(t,e){if("nullValue"in t)this.Ft(e,5);else if("booleanValue"in t)this.Ft(e,10),e.Mt(t.booleanValue?1:0);else if("integerValue"in t)this.Ft(e,15),e.Mt(_e(t.integerValue));else if("doubleValue"in t){const n=_e(t.doubleValue);isNaN(n)?this.Ft(e,13):(this.Ft(e,15),Ot(n)?e.Mt(0):e.Mt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Ft(e,20),"string"==typeof n&&(n=Ee(n)),e.xt("".concat(n.seconds||"")),e.Mt(n.nanos||0)}else if("stringValue"in t)this.Ot(t.stringValue,e),this.Nt(e);else if("bytesValue"in t)this.Ft(e,30),e.Bt(be(t.bytesValue)),this.Nt(e);else if("referenceValue"in t)this.Lt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Ft(e,45),e.Mt(n.latitude||0),e.Mt(n.longitude||0)}else"mapValue"in t?en(t)?this.Ft(e,Number.MAX_SAFE_INTEGER):$e(t)?this.kt(t.mapValue,e):(this.qt(t.mapValue,e),this.Nt(e)):"arrayValue"in t?(this.Qt(t.arrayValue,e),this.Nt(e)):R(19022,{$t:t})}Ot(t,e){this.Ft(e,25),this.Ut(t,e)}Ut(t,e){e.xt(t)}qt(t,e){const n=t.fields||{};this.Ft(e,55);for(const r of Object.keys(n))this.Ot(r,e),this.Ct(n[r],e)}kt(t,e){var n;const r=t.fields||{};this.Ft(e,53);const s=Pe,i=(null===(n=r[s].arrayValue)||void 0===n||null===(n=n.values)||void 0===n?void 0:n.length)||0;this.Ft(e,15),e.Mt(_e(i)),this.Ot(s,e),this.Ct(r[s],e)}Qt(t,e){const n=t.values||[];this.Ft(e,50);for(const r of n)this.Ct(r,e)}Lt(t,e){this.Ft(e,37),it.fromName(t).path.forEach((t=>{this.Ft(e,60),this.Ut(t,e)}))}Ft(t,e){t.Mt(e)}Nt(t){t.Mt(2)}}Qs.Kt=new Qs;class Ws{constructor(){this.Cn=new Xs}addToCollectionParentIndex(t,e){return this.Cn.add(e),At.resolve()}getCollectionParents(t,e){return At.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return At.resolve()}deleteFieldIndex(t,e){return At.resolve()}deleteAllFieldIndexes(t){return At.resolve()}createTargetIndexes(t,e){return At.resolve()}getDocumentsMatchingTarget(t,e){return At.resolve(null)}getIndexType(t,e){return At.resolve(0)}getFieldIndexes(t,e){return At.resolve([])}getNextCollectionGroupToUpdate(t){return At.resolve(null)}getMinOffset(t,e){return At.resolve(bt.min())}getMinOffsetFromCollectionGroup(t,e){return At.resolve(bt.min())}updateCollectionGroup(t,e,n){return At.resolve()}updateIndexEntries(t,e){return At.resolve()}}class Xs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ge(nt.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new ge(nt.comparator)).toArray()}}new Uint8Array(0);const Ys={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Js=41943040;class Zs{static withCacheSize(t){return new Zs(t,Zs.DEFAULT_COLLECTION_PERCENTILE,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Zs.DEFAULT_COLLECTION_PERCENTILE=10,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Zs.DEFAULT=new Zs(Js,Zs.DEFAULT_COLLECTION_PERCENTILE,Zs.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Zs.DISABLED=new Zs(-1,0,0);class $s{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new $s(0)}static cr(){return new $s(-1)}}const ti="LruGarbageCollector",ei=1048576;function ni(t,e){let[n,r]=t,[s,i]=e;const o=W(n,s);return 0===o?W(r,i):o}class ri{constructor(t){this.Ir=t,this.buffer=new ge(ni),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ni(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class si{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(t){A(ti,"Garbage collection scheduled in ".concat(t,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Nt(t)?A(ti,"Ignoring IndexedDB error during garbage collection: ",t):await It(t)}await this.Vr(3e5)}))}}class ii{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return At.resolve(kt.ce);const n=new ri(e);return this.mr.forEachTarget(t,(t=>n.Ar(t.sequenceNumber))).next((()=>this.mr.pr(t,(t=>n.Ar(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.mr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; disabled"),At.resolve(Ys)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(A("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(n," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),Ys):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let n,r,s,i,o,c,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(A("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(e)),r=this.params.maximumSequenceNumbersToCollect):r=e,i=Date.now(),this.nthSequenceNumber(t,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(t,n,e)))).next((e=>(s=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),I()<=a.in.DEBUG&&A("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(i-h,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-i)+"ms\n"+"\tRemoved ".concat(s," targets in ")+(c-o)+"ms\n"+"\tRemoved ".concat(t," documents in ")+(u-c)+"ms\n"+"Total Duration: ".concat(u-h,"ms")),At.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:t}))))}}function oi(t,e){return new ii(t,e)}class ai{constructor(){this.changes=new Yn((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,sn.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?At.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class ci{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class ui{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&xr(n.mutation,t,me.empty(),mt.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ar()).next((()=>e))))}getLocalViewOfDocuments(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ar();const r=nr();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=tr();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=nr();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ar())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=Zn();const i=sr(),o=sr();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Vr)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),xr(o.mutation,e,o.mutation.getFieldMask(),mt.now())):i.set(e.key,me.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new ci(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=sr();let r=new le(((t,e)=>t-e)),s=ar();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||me.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||ar()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=rr();c.forEach((t=>{if(!s.has(t)){const r=kr(e.get(t),n.get(t));null!==r&&u.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,u))}return At.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return it.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Pn(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):At.resolve(nr());let o=vt,a=s;return i.next((e=>At.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?At.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,ar()))).next((t=>({batchId:o,changes:er(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new it(e)).next((t=>{let e=tr();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=tr();return this.indexManager.getCollectionParents(t,s).next((o=>At.forEach(o,(o=>{const a=function(t,e){return new On(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,sn.newInvalidDocument(r)))}));let n=tr();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&xr(i.mutation,r,me.empty(),mt.now()),Kn(e,r)&&(n=n.insert(t,r))})),n}))}}class hi{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return At.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Es(t.createTime)}}(e)),At.resolve()}getNamedQuery(t,e){return At.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,function(t){return{name:t.name,query:Ks(t.bundledQuery),readTime:Es(t.readTime)}}(e)),At.resolve()}}class li{constructor(){this.overlays=new le(it.comparator),this.qr=new Map}getOverlay(t,e){return At.resolve(this.overlays.get(e))}getOverlays(t,e){const n=nr();return At.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.St(t,e,r)})),At.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.qr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.qr.delete(n)),At.resolve()}getOverlaysForCollection(t,e,n){const r=nr(),s=e.length+1,i=new it(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return At.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new le(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=nr(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=nr(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return At.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Gr(e,n));let s=this.qr.get(e);void 0===s&&(s=ar(),this.qr.set(e,s)),this.qr.set(e,s.add(n.key))}}class di{constructor(){this.sessionToken=ve.EMPTY_BYTE_STRING}getSessionToken(t){return At.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,At.resolve()}}class fi{constructor(){this.Qr=new ge(gi.$r),this.Ur=new ge(gi.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const n=new gi(t,e);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Gr(new gi(t,e))}zr(t,e){t.forEach((t=>this.removeReference(t,e)))}jr(t){const e=new it(new nt([])),n=new gi(e,t),r=new gi(e,t+1),s=[];return this.Ur.forEachInRange([n,r],(t=>{this.Gr(t),s.push(t.key)})),s}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new it(new nt([])),n=new gi(e,t),r=new gi(e,t+1);let s=ar();return this.Ur.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new gi(t,0),n=this.Qr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class gi{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return it.comparator(t.key,e.key)||W(t.Yr,e.Yr)}static Kr(t,e){return W(t.Yr,e.Yr)||it.comparator(t.key,e.key)}}class pi{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new ge(gi.$r)}checkEmpty(t){return At.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new qr(s,e,n,r);this.mutationQueue.push(i);for(const o of r)this.Zr=this.Zr.add(new gi(o.key,s)),this.indexManager.addToCollectionParentIndex(t,o.key.path.popLast());return At.resolve(i)}lookupMutationBatch(t,e){return At.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ei(n),s=r<0?0:r;return At.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return At.resolve(0===this.mutationQueue.length?Rt:this.tr-1)}getAllMutationBatches(t){return At.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new gi(e,0),r=new gi(e,Number.POSITIVE_INFINITY),s=[];return this.Zr.forEachInRange([n,r],(t=>{const e=this.Xr(t.Yr);s.push(e)})),At.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new ge(W);return e.forEach((t=>{const e=new gi(t,0),r=new gi(t,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([e,r],(t=>{n=n.add(t.Yr)}))})),At.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;it.isDocumentKey(s)||(s=s.child(""));const i=new gi(new it(s),0);let o=new ge(W);return this.Zr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Yr)),!0)}),i),At.resolve(this.ti(o))}ti(t){const e=[];return t.forEach((t=>{const n=this.Xr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){O(0===this.ni(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return At.forEach(e.mutations,(r=>{const s=new gi(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.Zr=n}))}ir(t){}containsKey(t,e){const n=new gi(e,0),r=this.Zr.firstAfterOrEqual(n);return At.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,At.resolve()}ni(t,e){return this.ei(t)}ei(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class mi{constructor(t){this.ri=t,this.docs=new le(it.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.ri(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return At.resolve(n?n.document.mutableCopy():sn.newInvalidDocument(e))}getEntries(t,e){let n=Zn();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():sn.newInvalidDocument(t))})),At.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=Zn();const i=e.path,o=new it(i.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||Tt(_t(o),n)<=0||(r.has(o.key)||Kn(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return At.resolve(s)}getAllFromCollectionGroup(t,e,n,r){R(9500)}ii(t,e){return At.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new yi(this)}getSize(t){return At.resolve(this.size)}}class yi extends ai{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.Nr.addEntry(t,r)):this.Nr.removeEntry(n)})),At.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class vi{constructor(t){this.persistence=t,this.si=new Yn((t=>kn(t)),Rn),this.lastRemoteSnapshotVersion=yt.min(),this.highestTargetId=0,this.oi=0,this._i=new fi,this.targetCount=0,this.ai=$s.ur()}forEachTarget(t,e){return this.si.forEach(((t,n)=>e(n))),At.resolve()}getLastRemoteSnapshotVersion(t){return At.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return At.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),At.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.oi&&(this.oi=e),At.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new $s(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,At.resolve()}updateTargetData(t,e){return this.Pr(e),At.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,At.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.si.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.si.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),At.waitFor(s).next((()=>r))}getTargetCount(t){return At.resolve(this.targetCount)}getTargetData(t,e){const n=this.si.get(e)||null;return At.resolve(n)}addMatchingKeys(t,e,n){return this._i.Wr(e,n),At.resolve()}removeMatchingKeys(t,e,n){this._i.zr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),At.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),At.resolve()}getMatchingKeysForTargetId(t,e){const n=this._i.Hr(e);return At.resolve(n)}containsKey(t,e){return At.resolve(this._i.containsKey(e))}}class wi{constructor(t,e){this.ui={},this.overlays={},this.ci=new kt(0),this.li=!1,this.li=!0,this.hi=new di,this.referenceDelegate=t(this),this.Pi=new vi(this),this.indexManager=new Ws,this.remoteDocumentCache=function(t){return new mi(t)}((t=>this.referenceDelegate.Ti(t))),this.serializer=new Hs(e),this.Ii=new hi(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new li,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ui[t.toKey()];return n||(n=new pi(e,this.referenceDelegate),this.ui[t.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,n){A("MemoryPersistence","Starting transaction:",t);const r=new Ei(this.ci.next());return this.referenceDelegate.Ei(),n(r).next((t=>this.referenceDelegate.di(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ai(t,e){return At.or(Object.values(this.ui).map((n=>()=>n.containsKey(t,e))))}}class Ei extends Ct{constructor(t){super(),this.currentSequenceNumber=t}}class _i{constructor(t){this.persistence=t,this.Ri=new fi,this.Vi=null}static mi(t){return new _i(t)}get fi(){if(this.Vi)return this.Vi;throw R(60996)}addReference(t,e,n){return this.Ri.addReference(n,e),this.fi.delete(n.toString()),At.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.fi.add(n.toString()),At.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),At.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((t=>this.fi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.fi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return At.forEach(this.fi,(n=>{const r=it.fromPath(n);return this.gi(t,r).next((t=>{t||e.removeEntry(r,yt.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((t=>{t?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return At.or([()=>At.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class bi{constructor(t,e){this.persistence=t,this.pi=new Yn((t=>Vt(t.path)),((t,e)=>t.isEqual(e))),this.garbageCollector=oi(this,e)}static mi(t,e){return new bi(t,e)}Ei(){}di(t){return At.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}wr(t){let e=0;return this.pr(t,(t=>{e++})).next((()=>e))}pr(t,e){return At.forEach(this.pi,((n,r)=>this.br(t,n,r).next((t=>t?At.resolve():e(r)))))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),s=r.newChangeBuffer();return r.ii(t,(r=>this.br(t,r,e).next((t=>{t||(n++,s.removeEntry(r,yt.min()))})))).next((()=>s.apply(t))).next((()=>n))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),At.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),At.resolve()}removeReference(t,e,n){return this.pi.set(n,t.currentSequenceNumber),At.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),At.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ke(t.data.value)),e}br(t,e,n){return At.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.pi.get(e);return At.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Ti{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.ds=r}static As(t,e){let n=ar(),r=ar();for(const s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Ti(t,e.fromCache,n,r)}}class Si{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Ci{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(0,c.G6)()?8:Dt((0,c.z$)())>0?6:4}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ys(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.ws(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Si;return this.Ss(t,e,n).next((r=>{if(s.result=r,this.Vs)return this.bs(t,e,n,r.size)}))})).next((()=>s.result))}bs(t,e,n,r){return n.documentReadCount<this.fs?(I()<=a.in.DEBUG&&A("QueryEngine","SDK will not create cache indexes for query:",Hn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),At.resolve()):(I()<=a.in.DEBUG&&A("QueryEngine","Query:",Hn(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(I()<=a.in.DEBUG&&A("QueryEngine","The SDK decides to create cache indexes for query:",Hn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Un(e))):At.resolve())}ys(t,e){if(Vn(e))return At.resolve(null);let n=Un(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=qn(e,null,"F"),n=Un(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=ar(...r);return this.ps.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Ds(e,r);return this.Cs(e,i,s,n.readTime)?this.ys(t,qn(e,null,"F")):this.vs(t,i,e,n)}))))})))))}ws(t,e,n,r){return Vn(e)||r.isEqual(yt.min())?At.resolve(null):this.ps.getDocuments(t,n).next((s=>{const i=this.Ds(e,s);return this.Cs(e,i,n,r)?At.resolve(null):(I()<=a.in.DEBUG&&A("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Hn(e)),this.vs(t,i,e,Et(r,vt)).next((t=>t)))}))}Ds(t,e){let n=new ge(Wn(t));return e.forEach(((e,r)=>{Kn(t,r)&&(n=n.add(r))})),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ss(t,e,n){return I()<=a.in.DEBUG&&A("QueryEngine","Using full collection scan to execute query:",Hn(e)),this.ps.getDocumentsMatchingQuery(t,e,bt.min(),n)}vs(t,e,n,r){return this.ps.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}const Ii="LocalStore",Ai=3e8;class Di{constructor(t,e,n,r){this.persistence=t,this.Fs=e,this.serializer=r,this.Ms=new le(W),this.xs=new Yn((t=>kn(t)),Rn),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(n)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new ui(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Ni(t,e,n,r){return new Di(t,e,n,r)}async function ki(t,e){const n=L(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n.Bs(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=ar();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({Ls:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function Ri(t){const e=L(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function xi(t,e,n){let r=ar(),s=ar();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Zn();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(yt.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):A(Ii,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{ks:r,qs:s}}))}function Oi(t,e){const n=L(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=Rt),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function Li(t,e){const n=L(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Pi.getTargetData(t,e).next((s=>s?(r=s,At.resolve(r)):n.Pi.allocateTargetId(t).next((s=>(r=new Gs(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Pi.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.xs.set(e,t.targetId)),t}))}async function Mi(t,e,n){const r=L(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Nt(t))throw t;A(Ii,"Failed to update sequence numbers for target ".concat(e,": ").concat(t))}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Vi(t,e,n){const r=L(t);let s=yt.min(),i=ar();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=L(t),s=r.xs.get(n);return void 0!==s?At.resolve(r.Ms.get(s)):r.Pi.getTargetData(e,n)}(r,t,Un(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.Fs.getDocumentsMatchingQuery(t,e,n?s:yt.min(),n?i:ar()))).next((t=>(Pi(r,Qn(e),t),{documents:t,Qs:i})))))}function Pi(t,e,n){let r=t.Os.get(e)||yt.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.Os.set(e,r)}class Fi{constructor(){this.activeTargetIds=ur()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ui{constructor(){this.Mo=new Fi,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,n){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new Fi,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Bi{Oo(t){}shutdown(){}}const ji="ConnectivityMonitor";class qi{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){A(ji,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){A(ji,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let zi=null;function Gi(){return null===zi?zi=268435456+Math.round(2147483648*Math.random()):zi++,"0x"+zi.toString(16)}const Hi="RestConnection",Ki={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Qi{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko="projects/".concat(n,"/databases/").concat(r),this.Wo=this.databaseId.database===Re?"project_id=".concat(n):"project_id=".concat(n,"&database_id=").concat(r)}Go(t,e,n,r,s){const i=Gi(),o=this.zo(t,e.toUriEncodedString());A(Hi,"Sending RPC '".concat(t,"' ").concat(i,":"),o,n);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,s);const{host:u}=new URL(o),h=(0,c.Xx)(u);return this.Jo(t,o,a,n,h).then((e=>(A(Hi,"Received RPC '".concat(t,"' ").concat(i,": "),e),e)),(e=>{throw N(Hi,"RPC '".concat(t,"' ").concat(i," failed with error: "),e,"url: ",o,"request:",n),e}))}Ho(t,e,n,r,s,i){return this.Go(t,e,n,r,s)}jo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+S,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}zo(t,e){const n=Ki[t];return"".concat(this.Uo,"/v1/").concat(e,":").concat(n)}terminate(){}}class Wi{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Xi="WebChannelConnection";class Yi extends Qi{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,s){const i=Gi();return new Promise(((s,o)=>{const a=new l;a.setWithCredentials(!0),a.listenOnce(f.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case g.NO_ERROR:const n=a.getResponseJson();A(Xi,"XHR for RPC '".concat(t,"' ").concat(i," received:"),JSON.stringify(n)),s(n);break;case g.TIMEOUT:A(Xi,"RPC '".concat(t,"' ").concat(i," timed out")),o(new V(M.DEADLINE_EXCEEDED,"Request time out"));break;case g.HTTP_ERROR:const r=a.getStatus();if(A(Xi,"RPC '".concat(t,"' ").concat(i," failed with status:"),r,"response text:",a.getResponseText()),r>0){var e;let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const n=null===(e=t)||void 0===e?void 0:e.error;if(n&&n.status&&n.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(e)>=0?e:M.UNKNOWN}(n.status);o(new V(t,n.message))}else o(new V(M.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new V(M.UNAVAILABLE,"Connection failed."));break;default:R(9055,{l_:t,streamId:i,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{A(Xi,"RPC '".concat(t,"' ").concat(i," completed."))}}));const c=JSON.stringify(r);A(Xi,"RPC '".concat(t,"' ").concat(i," sending request:"),r),a.send(e,"POST",c,n,15)}))}T_(t,e,n){const r=Gi(),s=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=v(),o=y(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=s.join("");A(Xi,"Creating RPC '".concat(t,"' stream ").concat(r,": ").concat(u),a);const h=i.createWebChannel(u,a);this.I_(h);let l=!1,f=!1;const g=new Wi({Yo:e=>{f?A(Xi,"Not sending because RPC '".concat(t,"' stream ").concat(r," is closed:"),e):(l||(A(Xi,"Opening RPC '".concat(t,"' stream ").concat(r," transport.")),h.open(),l=!0),A(Xi,"RPC '".concat(t,"' stream ").concat(r," sending:"),e),h.send(e))},Zo:()=>h.close()}),w=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return w(h,d.EventType.OPEN,(()=>{f||(A(Xi,"RPC '".concat(t,"' stream ").concat(r," transport opened.")),g.o_())})),w(h,d.EventType.CLOSE,(()=>{f||(f=!0,A(Xi,"RPC '".concat(t,"' stream ").concat(r," transport closed")),g.a_(),this.E_(h))})),w(h,d.EventType.ERROR,(e=>{f||(f=!0,N(Xi,"RPC '".concat(t,"' stream ").concat(r," transport errored. Name:"),e.name,"Message:",e.message),g.a_(new V(M.UNAVAILABLE,"The operation could not be completed")))})),w(h,d.EventType.MESSAGE,(e=>{if(!f){var n;const s=e.data[0];O(!!s,16349);const i=s,o=(null===i||void 0===i?void 0:i.error)||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){A(Xi,"RPC '".concat(t,"' stream ").concat(r," received error:"),o);const e=o.status;let n=function(t){const e=Kr[t];if(void 0!==e)return Xr(e)}(e),s=o.message;void 0===n&&(n=M.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),f=!0,g.a_(new V(n,s)),h.close()}else A(Xi,"RPC '".concat(t,"' stream ").concat(r," received:"),s),g.u_(s)}})),w(o,m.STAT_EVENT,(e=>{e.stat===p.PROXY?A(Xi,"RPC '".concat(t,"' stream ").concat(r," detected buffering proxy")):e.stat===p.NOPROXY&&A(Xi,"RPC '".concat(t,"' stream ").concat(r," detected no buffering proxy"))})),setTimeout((()=>{g.__()}),0),g}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Ji(){return"undefined"!=typeof document?document:null}function Zi(t){return new ps(t,!0)}class $i{constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=t,this.timerId=e,this.d_=n,this.A_=r,this.R_=s,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,e-n);r>0&&A("ExponentialBackoff","Backing off for ".concat(r," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(e," ms, last attempt: ").concat(n," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const to="PersistentStream";class eo{constructor(t,e,n,r,s,i,o,a){this.Mi=t,this.S_=n,this.b_=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new $i(t,e)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==t?this.M_.reset():e&&e.code===M.RESOURCE_EXHAUSTED?(D(e.toString()),D("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===M.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((t=>{let[n,r]=t;this.D_===e&&this.G_(n,r)}),(e=>{t((()=>{const t=new V(M.UNKNOWN,"Fetching auth token failed: "+e.message);return this.z_(t)}))}))}G_(t,e){const n=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{n((()=>this.listener.Xo()))})),this.stream.t_((()=>{n((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((t=>{n((()=>this.z_(t)))})),this.stream.onMessage((t=>{n((()=>1==++this.F_?this.J_(t):this.onNext(t)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return A(to,"close with error: ".concat(t)),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(A(to,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class no extends eo{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:R(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(O(void 0===e||"string"==typeof e,58123),ve.fromBase64String(e||"")):(O(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),ve.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?M.UNKNOWN:Xr(t.code);return new V(e,t.message||"")}(o);n=new as(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Cs(t,r.document.name),i=Es(r.document.updateTime),o=r.document.createTime?Es(r.document.createTime):yt.min(),a=new nn({mapValue:{fields:r.document.fields}}),c=sn.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new is(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Cs(t,r.document),i=r.readTime?Es(r.readTime):yt.min(),o=sn.newNoDocument(s,i),a=r.removedTargetIds||[];n=new is([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Cs(t,r.document),i=r.removedTargetIds||[];n=new is([],i,s,null)}else{if(!("filter"in e))return R(11601,{Rt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Hr(r,s),o=t.targetId;n=new os(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return yt.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?yt.min():e.readTime?Es(e.readTime):yt.min()}(t);return this.listener.H_(e,n)}Y_(t){const e={};e.database=Ds(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=xn(r)?{documents:xs(t,r)}:{query:Os(t,r).ft},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=vs(t,e.resumeToken);const r=ms(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(yt.min())>0){n.readTime=ys(t,e.snapshotVersion.toTimestamp());const r=ms(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.q_(e)}Z_(t){const e={};e.database=Ds(this.serializer),e.removeTarget=t,this.q_(e)}}class ro extends eo{constructor(t,e,n,r,s,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return O(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,O(!t.writeResults||0===t.writeResults.length,55816),this.listener.ta()}onNext(t){O(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=function(t,e){return t&&t.length>0?(O(void 0!==e,14353),t.map((t=>function(t,e){let n=t.updateTime?Es(t.updateTime):Es(e);return n.isEqual(yt.min())&&(n=Es(e)),new Ir(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Es(t.commitTime);return this.listener.na(n,e)}ra(){const t={};t.database=Ds(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Rs(this.serializer,t)))};this.q_(e)}}class so{}class io extends so{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new V(M.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((s=>{let[i,o]=s;return this.connection.Go(t,bs(e,n),r,i,o)})).catch((t=>{throw"FirebaseError"===t.name?(t.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new V(M.UNKNOWN,t.toString())}))}Ho(t,e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((i=>{let[o,a]=i;return this.connection.Ho(t,bs(e,n),r,o,a,s)})).catch((t=>{throw"FirebaseError"===t.name?(t.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new V(M.UNKNOWN,t.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class oo{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(t.toString())),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,"Online"===t&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e="Could not reach Cloud Firestore backend. ".concat(t,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(D(e),this.aa=!1):A("OnlineStateTracker",e)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const ao="RemoteStore";class co{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=s,this.Aa.Oo((t=>{n.enqueueAndForget((async()=>{vo(this)&&(A(ao,"Restarting streams for network reachability change."),await async function(t){const e=L(t);e.Ea.add(4),await ho(e),e.Ra.set("Unknown"),e.Ea.delete(4),await uo(e)}(this))}))})),this.Ra=new oo(n,r)}}async function uo(t){if(vo(t))for(const e of t.da)await e(!0)}async function ho(t){for(const e of t.da)await e(!1)}function lo(t,e){const n=L(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),yo(n)?mo(n):Po(n).O_()&&go(n,e))}function fo(t,e){const n=L(t),r=Po(n);n.Ia.delete(e),r.O_()&&po(n,e),0===n.Ia.size&&(r.O_()?r.L_():vo(n)&&n.Ra.set("Unknown"))}function go(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(yt.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Po(t).Y_(e)}function po(t,e){t.Va.Ue(e),Po(t).Z_(e)}function mo(t){t.Va=new us({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Po(t).start(),t.Ra.ua()}function yo(t){return vo(t)&&!Po(t).x_()&&t.Ia.size>0}function vo(t){return 0===L(t).Ea.size}function wo(t){t.Va=void 0}async function Eo(t){t.Ra.set("Online")}async function _o(t){t.Ia.forEach(((e,n)=>{go(t,e)}))}async function bo(t,e){wo(t),yo(t)?(t.Ra.ha(e),mo(t)):t.Ra.set("Unknown")}async function To(t,e,n){if(t.Ra.set("Online"),e instanceof as&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ia.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ia.delete(r),t.Va.removeTarget(r))}(t,e)}catch(n){A(ao,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await So(t,n)}else if(e instanceof is?t.Va.Ze(e):e instanceof os?t.Va.st(e):t.Va.tt(e),!n.isEqual(yt.min()))try{const e=await Ri(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Va.Tt(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.Ia.get(r);s&&t.Ia.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.Ia.get(e);if(!r)return;t.Ia.set(e,r.withResumeToken(ve.EMPTY_BYTE_STRING,r.snapshotVersion)),po(t,e);const s=new Gs(r.target,e,n,r.sequenceNumber);go(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){A(ao,"Failed to raise snapshot:",e),await So(t,e)}}async function So(t,e,n){if(!Nt(e))throw e;t.Ea.add(1),await ho(t),t.Ra.set("Offline"),n||(n=()=>Ri(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{A(ao,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await uo(t)}))}function Co(t,e){return e().catch((n=>So(t,n,e)))}async function Io(t){const e=L(t),n=Fo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Rt;for(;Ao(e);)try{const t=await Oi(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,Do(e,t)}catch(t){await So(e,t)}No(e)&&ko(e)}function Ao(t){return vo(t)&&t.Ta.length<10}function Do(t,e){t.Ta.push(e);const n=Fo(t);n.O_()&&n.X_&&n.ea(e.mutations)}function No(t){return vo(t)&&!Fo(t).x_()&&t.Ta.length>0}function ko(t){Fo(t).start()}async function Ro(t){Fo(t).ra()}async function xo(t){const e=Fo(t);for(const n of t.Ta)e.ea(n.mutations)}async function Oo(t,e,n){const r=t.Ta.shift(),s=zr.from(r,e,n);await Co(t,(()=>t.remoteSyncer.applySuccessfulWrite(s))),await Io(t)}async function Lo(t,e){e&&Fo(t).X_&&await async function(t,e){if(function(t){return Wr(t)&&t!==M.ABORTED}(e.code)){const n=t.Ta.shift();Fo(t).B_(),await Co(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Io(t)}}(t,e),No(t)&&ko(t)}async function Mo(t,e){const n=L(t);n.asyncQueue.verifyOperationInProgress(),A(ao,"RemoteStore received new credentials");const r=vo(n);n.Ea.add(3),await ho(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await uo(n)}async function Vo(t,e){const n=L(t);e?(n.Ea.delete(2),await uo(n)):e||(n.Ea.add(2),await ho(n),n.Ra.set("Unknown"))}function Po(t){return t.ma||(t.ma=function(t,e,n){const r=L(t);return r.sa(),new no(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:Eo.bind(null,t),t_:_o.bind(null,t),r_:bo.bind(null,t),H_:To.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),yo(t)?mo(t):t.Ra.set("Unknown")):(await t.ma.stop(),wo(t))}))),t.ma}function Fo(t){return t.fa||(t.fa=function(t,e,n){const r=L(t);return r.sa(),new ro(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ro.bind(null,t),r_:Lo.bind(null,t),ta:xo.bind(null,t),na:Oo.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await Io(t)):(await t.fa.stop(),t.Ta.length>0&&(A(ao,"Stopping write stream with ".concat(t.Ta.length," pending writes")),t.Ta=[]))}))),t.fa}class Uo{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new P,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Uo(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(M.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Bo(t,e){if(D("AsyncQueue","".concat(e,": ").concat(t)),Nt(t))return new V(M.UNAVAILABLE,"".concat(e,": ").concat(t));throw t}class jo{static emptySet(t){return new jo(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||it.comparator(e.key,n.key):(t,e)=>it.comparator(t.key,e.key),this.keyedMap=tr(),this.sortedSet=new le(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof jo))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new jo;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class qo{constructor(){this.ga=new le(it.comparator)}track(t){const e=t.doc.key,n=this.ga.get(e);n?0!==t.type&&3===n.type?this.ga=this.ga.insert(e,t):3===t.type&&1!==n.type?this.ga=this.ga.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ga=this.ga.remove(e):1===t.type&&2===n.type?this.ga=this.ga.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):R(63341,{Rt:t,pa:n}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,n)=>{t.push(n)})),t}}class zo{constructor(t,e,n,r,s,i,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new zo(t,e,jo.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0}}class Go{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Ho{constructor(){this.queries=Ko(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=L(t),r=n.queries;n.queries=Ko(),r.forEach(((t,n)=>{for(const r of n.Sa)r.onError(e)}))}(this,new V(M.ABORTED,"Firestore shutting down"))}}function Ko(){return new Yn((t=>Gn(t)),zn)}async function Qo(t,e){const n=L(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new Go,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(t){const n=Bo(t,"Initialization of query '".concat(Hn(e.query),"' failed"));return void e.onError(n)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Jo(n)}async function Wo(t,e){const n=L(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const t=i.Sa.indexOf(e);t>=0&&(i.Sa.splice(t,1),0===i.Sa.length?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Xo(t,e){const n=L(t);let r=!1;for(const s of e){const t=s.query,e=n.queries.get(t);if(e){for(const t of e.Sa)t.Fa(s)&&(r=!0);e.wa=s}}r&&Jo(n)}function Yo(t,e,n){const r=L(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Jo(t){t.Ca.forEach((t=>{t.next()}))}var Zo,$o;($o=Zo||(Zo={})).Ma="default",$o.Cache="cache";class ta{constructor(t,e,n){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new zo(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache)return!0;if(!this.Da())return!0;const n="Offline"!==e;return(!this.options.qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}ka(t){t=zo.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Zo.Cache}}class ea{constructor(t){this.key=t}}class na{constructor(t){this.key=t}}class ra{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=ar(),this.mutatedKeys=ar(),this.eu=Wn(t),this.tu=new jo(this.eu)}get nu(){return this.Ya}ru(t,e){const n=e?e.iu:new qo,r=e?e.tu:this.tu;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=Kn(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.su(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.eu(h,a)>0||c&&this.eu(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{tu:i,iu:n,Cs:o,mutatedKeys:s}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){var s;const i=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const o=t.iu.ya();o.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R(20277,{Rt:t})}};return n(t)-n(e)}(t.type,e.type)||this.eu(t.doc,e.doc))),this.ou(n),r=null!==(s=r)&&void 0!==s&&s;const a=e&&!r?this._u():[],c=0===this.Xa.size&&this.current&&!r?1:0,u=c!==this.Za;return this.Za=c,0!==o.length||u?{snapshot:new zo(this.query,t.tu,i,o,t.mutatedKeys,0===c,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({tu:this.tu,iu:new qo,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=ar(),this.tu.forEach((t=>{this.uu(t.key)&&(this.Xa=this.Xa.add(t.key))}));const e=[];return t.forEach((t=>{this.Xa.has(t)||e.push(new na(t))})),this.Xa.forEach((n=>{t.has(n)||e.push(new ea(n))})),e}cu(t){this.Ya=t.Qs,this.Xa=ar();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return zo.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const sa="SyncEngine";class ia{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class oa{constructor(t){this.key=t,this.hu=!1}}class aa{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Yn((t=>Gn(t)),zn),this.Iu=new Map,this.Eu=new Set,this.du=new le(it.comparator),this.Au=new Map,this.Ru=new fi,this.Vu={},this.mu=new Map,this.fu=$s.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function ca(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=Na(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await ha(r,e,n,!0),s}async function ua(t,e){const n=Na(t);await ha(n,e,!0,!1)}async function ha(t,e,n,r){const s=await Li(t.localStore,Un(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await la(t,e,i,"current"===o,s.resumeToken)),t.isPrimaryClient&&n&&lo(t.remoteStore,s),a}async function la(t,e,n,r,s){t.pu=(e,n,r)=>async function(t,e,n,r){let s=e.view.ru(n);s.Cs&&(s=await Vi(t.localStore,e.query,!1).then((t=>{let{documents:n}=t;return e.view.ru(n,s)})));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return Ta(t,e.targetId,a.au),a.snapshot}(t,e,n,r);const i=await Vi(t.localStore,e,!0),o=new ra(e,i.Qs),a=o.ru(i.documents),c=ss.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),u=o.applyChanges(a,t.isPrimaryClient,c);Ta(t,n,u.au);const h=new ia(e,n,o);return t.Tu.set(e,h),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),u.snapshot}async function da(t,e,n){const r=L(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((t=>!zn(t,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Mi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&fo(r.remoteStore,s.targetId),_a(r,s.targetId)})).catch(It)):(_a(r,s.targetId),await Mi(r.localStore,s.targetId,!0))}async function fa(t,e){const n=L(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),fo(n.remoteStore,r.targetId))}async function ga(t,e){const n=L(t);try{const t=await function(t,e){const n=L(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const o=[];e.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Pi.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Pi.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(ve.EMPTY_BYTE_STRING,yt.min()).withLastLimboFreeSnapshotVersion(yt.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=Ai||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(c,u,i)&&o.push(n.Pi.updateTargetData(t,u))}));let a=Zn(),c=ar();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(xi(t,i,e.documentUpdates).next((t=>{a=t.ks,c=t.qs}))),!r.isEqual(yt.min())){const e=n.Pi.getLastRemoteSnapshotVersion(t).next((e=>n.Pi.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return At.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ms=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Au.get(e);r&&(O(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?O(r.hu,14607):t.removedDocuments.size>0&&(O(r.hu,42227),r.hu=!1))})),await Ia(n,t,e)}catch(t){await It(t)}}function pa(t,e,n){const r=L(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.Tu.forEach(((n,r)=>{const s=r.view.va(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=L(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const s of n.Sa)s.va(e)&&(r=!0)})),r&&Jo(n)}(r.eventManager,e),t.length&&r.Pu.H_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function ma(t,e,n){const r=L(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let t=new le(it.comparator);t=t.insert(i,sn.newNoDocument(i,yt.min()));const n=ar().add(i),s=new rs(yt.min(),new Map,new le(W),t,n);await ga(r,s),r.du=r.du.remove(i),r.Au.delete(e),Ca(r)}else await Mi(r.localStore,e,!1).then((()=>_a(r,e,n))).catch(It)}async function ya(t,e){const n=L(t),r=e.batch.batchId;try{const t=await function(t,e){const n=L(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),s=n.Ns.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=At.resolve();return i.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);O(null!==i,48541),e.version.compareTo(i)<0&&(s.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,s)))}(n,t,e,s).next((()=>s.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ar();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Ea(n,r,null),wa(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ia(n,t)}catch(t){await It(t)}}async function va(t,e,n){const r=L(t);try{const t=await function(t,e){const n=L(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(O(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Ea(r,e,n),wa(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ia(r,t)}catch(n){await It(n)}}function wa(t,e){(t.mu.get(e)||[]).forEach((t=>{t.resolve()})),t.mu.delete(e)}function Ea(t,e,n){const r=L(t);let s=r.Vu[r.currentUser.toKey()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function _a(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((e=>{t.Ru.containsKey(e)||ba(t,e)}))}function ba(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);null!==n&&(fo(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Ca(t))}function Ta(t,e,n){for(const r of n)r instanceof ea?(t.Ru.addReference(r.key,e),Sa(t,r)):r instanceof na?(A(sa,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||ba(t,r.key)):R(19791,{wu:r})}function Sa(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(A(sa,"New document in limbo: "+n),t.Eu.add(r),Ca(t))}function Ca(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new it(nt.fromString(e)),r=t.fu.next();t.Au.set(r,new oa(n)),t.du=t.du.insert(n,r),lo(t.remoteStore,new Gs(Un(Mn(n.path)),r,"TargetPurposeLimboResolution",kt.ce))}}async function Ia(t,e,n){const r=L(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach(((t,a)=>{o.push(r.pu(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient){var e;const s=t?!t.fromCache:null===n||void 0===n||null===(e=n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(t){s.push(t);const e=Ti.As(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.Pu.H_(s),await async function(t,e){const n=L(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>At.forEach(e,(e=>At.forEach(e.Es,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>At.forEach(e.ds,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Nt(t))throw t;A(Ii,"Failed to update sequence numbers: "+t)}for(const r of e){const t=r.targetId;if(!r.fromCache){const e=n.Ms.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.Ms=n.Ms.insert(t,s)}}}(r.localStore,i))}async function Aa(t,e){const n=L(t);if(!n.currentUser.isEqual(e)){A(sa,"User change. New user:",e.toKey());const t=await ki(n.localStore,e);n.currentUser=e,function(t,e){t.mu.forEach((t=>{t.forEach((t=>{t.reject(new V(M.CANCELLED,e))}))})),t.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Ia(n,t.Ls)}}function Da(t,e){const n=L(t),r=n.Au.get(e);if(r&&r.hu)return ar().add(r.key);{let t=ar();const r=n.Iu.get(e);if(!r)return t;for(const e of r){const r=n.Tu.get(e);t=t.unionWith(r.view.nu)}return t}}function Na(t){const e=L(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=ga.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Da.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ma.bind(null,e),e.Pu.H_=Xo.bind(null,e.eventManager),e.Pu.yu=Yo.bind(null,e.eventManager),e}function ka(t){const e=L(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ya.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=va.bind(null,e),e}class Ra{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Zi(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Ni(this.persistence,new Ci,t.initialUser,this.serializer)}Cu(t){return new wi(_i.mi,this.serializer)}Du(t){return new Ui}async terminate(){var t,e;null!==(t=this.gcScheduler)&&void 0!==t&&t.stop(),null!==(e=this.indexBackfillerScheduler)&&void 0!==e&&e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ra.provider={build:()=>new Ra};class xa extends Ra{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){O(this.persistence.referenceDelegate instanceof bi,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new si(n,t.asyncQueue,e)}Cu(t){const e=void 0!==this.cacheSizeBytes?Zs.withCacheSize(this.cacheSizeBytes):Zs.DEFAULT;return new wi((t=>bi.mi(t,e)),this.serializer)}}class Oa{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>pa(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Aa.bind(null,this.syncEngine),await Vo(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Ho}createDatastore(t){const e=Zi(t.databaseInfo.databaseId),n=function(t){return new Yi(t)}(t.databaseInfo);return function(t,e,n,r){return new io(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new co(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>pa(this.syncEngine,t,0)),qi.v()?new qi:new Bi)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new aa(t,e,n,r,s,i);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=L(t);A(ao,"RemoteStore shutting down."),e.Ea.add(5),await ho(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),null!==(t=this.datastore)&&void 0!==t&&t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}Oa.provider={build:()=>new Oa};class La{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):D("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const Ma="FirestoreClient";class Va{constructor(t,e,n,r,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=T.UNAUTHENTICATED,this.clientId=Q.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async t=>{A(Ma,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(A(Ma,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new P;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Bo(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Pa(t,e){t.asyncQueue.verifyOperationInProgress(),A(Ma,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await ki(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Fa(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Ua(t);A(Ma,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Mo(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Mo(e.remoteStore,n))),t._onlineComponents=e}async function Ua(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){A(Ma,"Using user provided OfflineComponentProvider");try{await Pa(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===M.FAILED_PRECONDITION||t.code===M.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;N("Error using user provided cache. Falling back to memory cache: "+n),await Pa(t,new Ra)}}else A(Ma,"Using default OfflineComponentProvider"),await Pa(t,new xa(void 0));return t._offlineComponents}async function Ba(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(A(Ma,"Using user provided OnlineComponentProvider"),await Fa(t,t._uninitializedComponentsProvider._online)):(A(Ma,"Using default OnlineComponentProvider"),await Fa(t,new Oa))),t._onlineComponents}function ja(t){return Ba(t).then((t=>t.syncEngine))}async function qa(t){const e=await Ba(t),n=e.eventManager;return n.onListen=ca.bind(null,e.syncEngine),n.onUnlisten=da.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=ua.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=fa.bind(null,e.syncEngine),n}function za(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new P;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new La({next:a=>{i.Nu(),e.enqueueAndForget((()=>Wo(t,o)));const c=a.docs.has(n);!c&&a.fromCache?s.reject(new V(M.UNAVAILABLE,"Failed to get document because the client is offline.")):c&&a.fromCache&&r&&"server"===r.source?s.reject(new V(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:t=>s.reject(t)}),o=new ta(Mn(n.path),i,{includeMetadataChanges:!0,qa:!0});return Qo(t,o)}(await qa(t),t.asyncQueue,e,n,r))),r.promise}function Ga(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=new P;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new La({next:n=>{i.Nu(),e.enqueueAndForget((()=>Wo(t,o))),n.fromCache&&"server"===r.source?s.reject(new V(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:t=>s.reject(t)}),o=new ta(n,i,{includeMetadataChanges:!0,qa:!0});return Qo(t,o)}(await qa(t),t.asyncQueue,e,n,r))),r.promise}function Ha(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Ka=new Map,Qa="firestore.googleapis.com";class Wa{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new V(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Qa,this.ssl=true}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=Js;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<ei)throw new V(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new V(M.INVALID_ARGUMENT,"".concat(t," and ").concat(n," cannot be used together."))})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ha(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new V(M.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (must not be NaN)"));if(t.timeoutSeconds<5)throw new V(M.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (minimum allowed value is 5)"));if(t.timeoutSeconds>30)throw new V(M.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(t.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Xa{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Wa({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new V(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Wa(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new U;switch(t.type){case"firstParty":return new z(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new V(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Ka.get(t);e&&(A("ComponentProvider","Removing Datastore"),Ka.delete(t),e.terminate())}(this),Promise.resolve()}}class Ya{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Ya(this.firestore,t,this._query)}}class Ja{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Za(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ja(this.firestore,t,this._key)}toJSON(){return{type:Ja._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,n){if(ft(e,Ja._jsonSchema))return new Ja(t,n||null,new it(nt.fromString(e.referencePath)))}}Ja._jsonSchemaVersion="firestore/documentReference/1.0",Ja._jsonSchema={type:dt("string",Ja._jsonSchemaVersion),referencePath:dt("string")};class Za extends Ya{constructor(t,e,n){super(t,e,Mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ja(this.firestore,null,new it(t))}withConverter(t){return new Za(this.firestore,t,this._path)}}function $a(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];if(t=(0,c.m9)(t),ot("collection","path",e),t instanceof Xa){const n=nt.fromString(e,...r);return ct(n),new Za(t,null,n)}{if(!(t instanceof Ja||t instanceof Za))throw new V(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(nt.fromString(e,...r));return ct(n),new Za(t.firestore,null,n)}}function tc(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];if(t=(0,c.m9)(t),1===arguments.length&&(e=Q.newId()),ot("doc","path",e),t instanceof Xa){const n=nt.fromString(e,...r);return at(n),new Ja(t,null,new it(n))}{if(!(t instanceof Ja||t instanceof Za))throw new V(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t._path.child(nt.fromString(e,...r));return at(n),new Ja(t.firestore,t instanceof Za?t.converter:null,new it(n))}}const ec="AsyncQueue";class nc{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new $i(this,"async_queue_retry"),this._c=()=>{const t=Ji();t&&A(ec,"Visibility state changed to "+t.visibilityState),this.M_.w_()},this.ac=t;const e=Ji();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Ji();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new P;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Nt(t))throw t;A(ec,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((t=>{throw this.nc=t,this.rc=!1,D("INTERNAL UNHANDLED ERROR: ",rc(t)),t})).then((t=>(this.rc=!1,t))))));return this.ac=e,e}enqueueAfterDelay(t,e,n){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const r=Uo.createAndSchedule(this,t,e,n,(t=>this.hc(t)));return this.tc.push(r),r}uc(){this.nc&&R(47125,{Pc:rc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do{t=this.ac,await t}while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function rc(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}class sc extends Xa{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new nc,this._persistenceKey=(null===r||void 0===r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new nc(t),this._firestoreClient=void 0,await t}}}function ic(t,e){const n="object"==typeof t?t:(0,i.Mq)(),r="string"==typeof t?t:e||Re,s=(0,i.qX)(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const t=(0,c.P0)("firestore");t&&function(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};t=lt(t,Xa);const s=(0,c.Xx)(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},a="".concat(e,":").concat(n);s&&((0,c.Uo)("https://".concat(a)),(0,c.dp)("Firestore",!0)),i.host!==Qa&&i.host!==a&&N("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:a,ssl:s,emulatorOptions:r};if(!(0,c.vZ)(u,o)&&(t._setSettings(u),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=T.MOCK_USER;else{var h;e=(0,c.Sg)(r.mockUserToken,null===(h=t._app)||void 0===h?void 0:h.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new V(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new T(s)}t._authCredentials=new B(new F(e,n))}}(s,...t)}return s}function oc(t){if(t._terminated)throw new V(M.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||ac(t),t._firestoreClient}function ac(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new ke(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Ha(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._componentsProvider||null!==(n=s.localCache)&&void 0!==n&&n._offlineComponentProvider&&null!==(r=s.localCache)&&void 0!==r&&r._onlineComponentProvider&&(t._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),t._firestoreClient=new Va(t._authCredentials,t._appCheckCredentials,t._queue,i,t._componentsProvider&&function(t){const e=null===t||void 0===t?void 0:t._online.build();return{_offline:null===t||void 0===t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}class cc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new cc(ve.fromBase64String(t))}catch(t){throw new V(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new cc(ve.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:cc._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ft(t,cc._jsonSchema))return cc.fromBase64String(t.bytes)}}cc._jsonSchemaVersion="firestore/bytes/1.0",cc._jsonSchema={type:dt("string",cc._jsonSchemaVersion),bytes:dt("string")};class uc{constructor(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(let r=0;r<e.length;++r)if(0===e[r].length)throw new V(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new st(e)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class hc{constructor(t){this._methodName=t}}class lc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return W(this._lat,t._lat)||W(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:lc._jsonSchemaVersion}}static fromJSON(t){if(ft(t,lc._jsonSchema))return new lc(t.latitude,t.longitude)}}lc._jsonSchemaVersion="firestore/geoPoint/1.0",lc._jsonSchema={type:dt("string",lc._jsonSchemaVersion),latitude:dt("number"),longitude:dt("number")};class dc{constructor(t){this._values=(t||[]).map((t=>t))}toArray(){return this._values.map((t=>t))}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}toJSON(){return{type:dc._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ft(t,dc._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((t=>"number"==typeof t)))return new dc(t.vectorValues);throw new V(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}dc._jsonSchemaVersion="firestore/vectorValue/1.0",dc._jsonSchema={type:dt("string",dc._jsonSchemaVersion),vectorValues:dt("object")};const fc=/^__.*__$/;class gc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Vr(t,this.data,this.fieldMask,e,this.fieldTransforms):new Mr(t,this.data,e,this.fieldTransforms)}}class pc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Vr(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function mc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R(40011,{Ac:t})}}class yc{constructor(t,e,n,r,s,i){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Rc(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new yc({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Vc({path:n,fc:!1});return r.gc(t),r}yc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Oc(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(0===t.length)throw this.Sc("Document fields must not be empty");if(mc(this.Ac)&&fc.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class vc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Zi(t)}Cc(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new yc({Ac:t,methodName:e,Dc:n,path:st.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wc(t){const e=t._freezeSettings(),n=Zi(t._databaseId);return new vc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Ec(t,e,n,r,s){let i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Nc("Data must be an object, but it was:",o,r);const a=Ac(r,o);let c,u;if(i.merge)c=new me(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){const s=kc(e,r,n);if(!o.contains(s))throw new V(M.INVALID_ARGUMENT,"Field '".concat(s,"' is specified in your field mask but missing from your input data."));Lc(t,s)||t.push(s)}c=new me(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new gc(new nn(a),c,u)}class _c extends hc{_toFieldTransform(t){if(2!==t.Ac)throw 1===t.Ac?t.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):t.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof _c}}class bc extends hc{constructor(t,e){super(t),this.Fc=e}_toFieldTransform(t){const e=new br(t.serializer,dr(t.serializer,this.Fc));return new Cr(t.path,e)}isEqual(t){return t instanceof bc&&this.Fc===t.Fc}}function Tc(t,e,n,r){const s=t.Cc(1,e,n);Nc("Data must be an object, but it was:",s,r);const i=[],o=nn.empty();ue(r,((t,r)=>{const a=xc(e,t,n);r=(0,c.m9)(r);const u=s.yc(a);if(r instanceof _c)i.push(a);else{const t=Ic(r,u);null!=t&&(i.push(a),o.set(a,t))}}));const a=new me(i);return new pc(o,a,s.fieldTransforms)}function Sc(t,e,n,r,s,i){const o=t.Cc(1,e,n),a=[kc(e,r,n)],u=[s];if(i.length%2!=0)throw new V(M.INVALID_ARGUMENT,"Function ".concat(e,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let c=0;c<i.length;c+=2)a.push(kc(e,i[c])),u.push(i[c+1]);const h=[],l=nn.empty();for(let f=a.length-1;f>=0;--f)if(!Lc(h,a[f])){const t=a[f];let e=u[f];e=(0,c.m9)(e);const n=o.yc(t);if(e instanceof _c)h.push(t);else{const r=Ic(e,n);null!=r&&(h.push(t),l.set(t,r))}}const d=new me(h);return new pc(l,d,o.fieldTransforms)}function Cc(t,e,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Ic(n,t.Cc(r?4:3,e))}function Ic(t,e){if(Dc(t=(0,c.m9)(t)))return Nc("Unsupported field value:",e,t),Ac(t,e);if(t instanceof hc)return function(t,e){if(!mc(e.Ac))throw e.Sc("".concat(t._methodName,"() can only be used with update() and set()"));if(!e.path)throw e.Sc("".concat(t._methodName,"() is not currently supported inside arrays"));const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&4!==e.Ac)throw e.Sc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Ic(s,e.wc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,c.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return dr(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=mt.fromDate(t);return{timestampValue:ys(e.serializer,n)}}if(t instanceof mt){const n=new mt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ys(e.serializer,n)}}if(t instanceof lc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof cc)return{bytesValue:vs(e.serializer,t._byteString)};if(t instanceof Ja){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.Sc("Document reference is for database ".concat(r.projectId,"/").concat(r.database," but should be for database ").concat(n.projectId,"/").concat(n.database));return{referenceValue:_s(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof dc)return function(t,e){return{mapValue:{fields:{[Oe]:{stringValue:Ve},[Pe]:{arrayValue:{values:t.toArray().map((t=>{if("number"!=typeof t)throw e.Sc("VectorValues must only contain numeric values.");return hr(e.serializer,t)}))}}}}}}(t,e);throw e.Sc("Unsupported field value: ".concat(ht(t)))}(t,e)}function Ac(t,e){const n={};return he(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ue(t,((t,r)=>{const s=Ic(r,e.mc(t));null!=s&&(n[t]=s)})),{mapValue:{fields:n}}}function Dc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof mt||t instanceof lc||t instanceof cc||t instanceof Ja||t instanceof hc||t instanceof dc)}function Nc(t,e,n){if(!Dc(n)||!ut(n)){const r=ht(n);throw"an object"===r?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function kc(t,e,n){if((e=(0,c.m9)(e))instanceof uc)return e._internalPath;if("string"==typeof e)return xc(t,e);throw Oc("Field path arguments must be of type string or ",t,!1,void 0,n)}const Rc=new RegExp("[~\\*/\\[\\]]");function xc(t,e,n){if(e.search(Rc)>=0)throw Oc("Invalid field path (".concat(e,"). Paths must not contain '~', '*', '/', '[', or ']'"),t,!1,void 0,n);try{return new uc(...e.split("."))._internalPath}catch(r){throw Oc("Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),t,!1,void 0,n)}}function Oc(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a="Function ".concat(e,"() called with invalid data");n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=" in field ".concat(r)),o&&(c+=" in document ".concat(s)),c+=")"),new V(M.INVALID_ARGUMENT,a+t+c)}function Lc(t,e){return t.some((t=>t.isEqual(e)))}class Mc{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ja(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Vc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Pc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Vc extends Mc{data(){return super.data()}}function Pc(t,e){return"string"==typeof e?xc(t,e):e instanceof uc?e._internalPath:e._delegate._internalPath}function Fc(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new V(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uc{}class Bc extends Uc{}function jc(t,e){let n=[];for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];e instanceof Uc&&n.push(e),n=n.concat(s),function(t){const e=t.filter((t=>t instanceof Gc)).length,n=t.filter((t=>t instanceof qc)).length;if(e>1||e>0&&n>0)throw new V(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const o of n)t=o._apply(t);return t}class qc extends Bc{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new qc(t,e,n)}_apply(t){const e=this._parse(t);return Qc(t._query,e),new Ya(t.firestore,t.converter,jn(t._query,e))}_parse(t){const e=wc(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new V(M.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){Kc(o,i);const e=[];for(const n of o)e.push(Hc(r,t,n));a={arrayValue:{values:e}}}else a=Hc(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Kc(o,i),a=Cc(n,e,o,"in"===i||"not-in"===i);return dn.create(s,i,a)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function zc(t,e,n){const r=e,s=Pc("where",t);return qc._create(s,r,n)}class Gc extends Uc{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Gc(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:fn.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const s of r)Qc(n,s),n=jn(n,s)}(t._query,e),new Ya(t.firestore,t.converter,jn(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function Hc(t,e,n){if("string"==typeof(n=(0,c.m9)(n))){if(""===n)throw new V(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pn(e)&&-1!==n.indexOf("/"))throw new V(M.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));const r=e.path.child(nt.fromString(n));if(!it.isDocumentKey(r))throw new V(M.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Qe(t,new it(r))}if(n instanceof Ja)return Qe(t,n._key);throw new V(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(ht(n),"."))}function Kc(t,e){if(!Array.isArray(t)||0===t.length)throw new V(M.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(e.toString(),"' filters."))}function Qc(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new V(M.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(e.op.toString(),"' filter.")):new V(M.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(e.op.toString(),"' filters with '").concat(n.toString(),"' filters."))}class Wc{convertValue(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Fe(t)){case 0:return null;case 1:return t.booleanValue;case 2:return _e(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(be(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw R(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const n={};return ue(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertVectorValue(t){var e;const n=null===(e=t.fields)||void 0===e||null===(e=e[Pe].arrayValue)||void 0===e||null===(e=e.values)||void 0===e?void 0:e.map((t=>_e(t.doubleValue)));return new dc(n)}convertGeoPoint(t){return new lc(_e(t.latitude),_e(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=De(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ne(t));default:return null}}convertTimestamp(t){const e=Ee(t);return new mt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=nt.fromString(t);O(zs(n),9688,{name:t});const r=new xe(n.get(1),n.get(3)),s=new it(n.popFirst(5));return r.isEqual(e)||D("Document ".concat(s," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(e.projectId,"/").concat(e.database,") instead.")),s}}function Xc(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Yc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Jc extends Mc{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const e=new Zc(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const n=this._document.data.field(Pc("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Jc._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),t&&t.isValidDocument()&&t.isFoundDocument()?(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e):e}}Jc._jsonSchemaVersion="firestore/documentSnapshot/1.0",Jc._jsonSchema={type:dt("string",Jc._jsonSchemaVersion),bundleSource:dt("string","DocumentSnapshot"),bundleName:dt("string"),bundle:dt("string")};class Zc extends Jc{data(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(t)}}class $c{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Yc(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Zc(this._firestore,this._userDataWriter,n.key,n,new Yc(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(){const t=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new Zc(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Yc(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new Zc(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Yc(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let s=-1,i=-1;return 0!==e.type&&(s=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:tu(e.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=$c._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Q.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],n=[],r=[];return this.docs.forEach((t=>{null!==t._document&&(e.push(t._document),n.push(this._userDataWriter.convertObjectMap(t._document.data.value.mapValue.fields,"previous")),r.push(t.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function tu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R(61501,{type:t})}}function eu(t){t=lt(t,Ja);const e=lt(t.firestore,sc);return za(oc(e),t._key).then((n=>au(e,t,n)))}$c._jsonSchemaVersion="firestore/querySnapshot/1.0",$c._jsonSchema={type:dt("string",$c._jsonSchemaVersion),bundleSource:dt("string","QuerySnapshot"),bundleName:dt("string"),bundle:dt("string")};class nu extends Wc{constructor(t){super(),this.firestore=t}convertBytes(t){return new cc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ja(this.firestore,null,e)}}function ru(t){t=lt(t,Ya);const e=lt(t.firestore,sc),n=oc(e),r=new nu(e);return Fc(t._query),Ga(n,t._query).then((n=>new $c(e,r,t,n)))}function su(t,e,n){t=lt(t,Ja);const r=lt(t.firestore,sc),s=Xc(t.converter,e,n);return ou(r,[Ec(wc(r),"setDoc",t._key,s,null!==t.converter,n).toMutation(t._key,Ar.none())])}function iu(t,e,n){t=lt(t,Ja);const r=lt(t.firestore,sc),s=wc(r);let i;for(var o=arguments.length,a=new Array(o>3?o-3:0),u=3;u<o;u++)a[u-3]=arguments[u];return i="string"==typeof(e=(0,c.m9)(e))||e instanceof uc?Sc(s,"updateDoc",t._key,e,n,a):Tc(s,"updateDoc",t._key,e),ou(r,[i.toMutation(t._key,Ar.exists(!0))])}function ou(t,e){return function(t,e){const n=new P;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=ka(t);try{const t=await function(t,e){const n=L(t),r=mt.now(),s=e.reduce(((t,e)=>t.add(e.key)),ar());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Zn(),c=ar();return n.Ns.getEntries(t,s).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((s=>{i=s;const o=[];for(const t of e){const e=Or(t,i.get(t.key).overlayedDocument);null!=e&&o.push(new Vr(t.key,e,rn(e.value.mapValue),Ar.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:er(i)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Vu[t.currentUser.toKey()];r||(r=new le(W)),r=r.insert(e,n),t.Vu[t.currentUser.toKey()]=r}(r,t.batchId,n),await Ia(r,t.changes),await Io(r.remoteStore)}catch(t){const e=Bo(t,"Failed to persist write");n.reject(e)}}(await ja(t),e,n))),n.promise}(oc(t),e)}function au(t,e,n){const r=n.docs.get(e._key),s=new nu(t);return new Jc(t,s,e._key,r,new Yc(n.hasPendingWrites,n.fromCache),e.converter)}function cu(t){return new bc("increment",t)}new WeakMap;!function(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(t){S=t}(i.Jn),(0,i.Xd)(new o.wA("firestore",((t,n)=>{let{instanceIdentifier:r,options:s}=n;const i=t.getProvider("app").getImmediate(),o=new sc(new j(t.getProvider("auth-internal")),new H(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new V(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xe(t.options.projectId,e)}(i,r),i);return s={useFetchStreams:e,...s},o._setSettings(s),o}),"PUBLIC").setMultipleInstances(!0)),(0,i.KN)(_,b,t),(0,i.KN)(_,b,"esm2020")}()}}]);
//# sourceMappingURL=465.8a112703.chunk.js.map