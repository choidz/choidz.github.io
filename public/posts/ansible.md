# Ansible ì •ë¦¬

---

**Ansible ì™„ë²½ ì •ë¦¬ (ê¸°ì´ˆë¶€í„° í•µì‹¬ ê°œë…ê¹Œì§€)**
DevOps í™˜ê²½ì—ì„œ ë¹ ì§ˆ ìˆ˜ ì—†ëŠ” ìë™í™” ë„êµ¬, **Ansible**!
ì´ ê¸€ì—ì„œëŠ” Ansibleì˜ ê°œë…ë¶€í„° ì£¼ìš” êµ¬ì„± ìš”ì†Œ, ì‚¬ìš© ì˜ˆì‹œê¹Œì§€ í•œëˆˆì— ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤.

---

**ğŸ’¡ 1. Ansibleì´ë€?**
**Ansible** ì€ ì‹œìŠ¤í…œ ì„¤ì •, ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬, ì„œë²„ ê´€ë¦¬ ë“±ì„ ìë™í™”í•´ì£¼ëŠ” **ì˜¤í”ˆì†ŒìŠ¤ ë„êµ¬** ì…ë‹ˆë‹¤.
ë³µì¡í•œ ì„œë²„ í™˜ê²½ì„ ì‰½ê²Œ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ **YAML ê¸°ë°˜** ìœ¼ë¡œ ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤.
**âœ… ì£¼ìš” íŠ¹ì§•**
  * **ì—ì´ì „íŠ¸ë¦¬ìŠ¤ (Agentless)** : SSHë¡œ ì—°ê²°, ëŒ€ìƒ ì„œë²„ì— í”„ë¡œê·¸ë¨ ì„¤ì¹˜ ë¶ˆí•„ìš”
  * **YAML ê¸°ë°˜** : ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ êµ¬ì„±
  * **Idempotence (ë¶ˆë³€ì„±)** : ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•´ë„ ê²°ê³¼ê°€ ë™ì¼
  * **Push ë°©ì‹** : ì¤‘ì•™ì—ì„œ ëª…ë ¹ì„ ê° ì„œë²„ë¡œ í‘¸ì‹œ
  * **í™•ì¥ì„±** : ìˆ˜ë°± ëŒ€ì˜ ì„œë²„ë¥¼ ë™ì‹œì— ê´€ë¦¬ ê°€ëŠ¥

---

**ğŸ§© 2. Ansible êµ¬ì„±ìš”ì†Œ**

| êµ¬ì„±ìš”ì†Œ      | ì„¤ëª…                         |
| --------- | -------------------------- |
| Inventory | ì œì–´í•  í˜¸ìŠ¤íŠ¸(ì„œë²„) ëª©ë¡             |
| Playbook  | YAMLë¡œ ì‘ì„±ëœ ìë™í™” ì‹œë‚˜ë¦¬ì˜¤         |
| Module    | ì‹¤ì œ ì‘ì—…(íŒ¨í‚¤ì§€ ì„¤ì¹˜, íŒŒì¼ ë³µì‚¬ ë“±)ì„ ìˆ˜í–‰ |
| Task      | Playbook ë‚´ì˜ ë‹¨ì¼ ì‘ì—…          |
| Handler   | íŠ¹ì • ì¡°ê±´ ì‹œ ì‹¤í–‰ë˜ëŠ” íŠ¸ë¦¬ê±°           |
| Role      | Playbookì„ êµ¬ì¡°ì ìœ¼ë¡œ ë¬¶ì€ ë‹¨ìœ„      |

---

**ğŸŒ 3. Inventory (ì¸ë²¤í† ë¦¬)**
Ansibleì´ ì œì–´í•  ì„œë²„ë“¤ì˜ **ëª©ë¡ê³¼ ì ‘ì† ì •ë³´** ë¥¼ ë‹´ì€ íŒŒì¼ì…ë‹ˆë‹¤.
ê¸°ë³¸ ìœ„ì¹˜ëŠ” /etc/ansible/hosts.
**ğŸ“‚ ì˜ˆì‹œ**
[webservers] 192.168.0.10 ansible_user=ubuntu 192.168.0.11 ansible_user=ubuntu 
**ğŸ”§ ì£¼ìš” ì˜µì…˜**

| í•­ëª©                 | ì„¤ëª…                   |
| ------------------ | -------------------- |
| ansible_host       | ëŒ€ìƒ ì„œë²„ IP ë˜ëŠ” í˜¸ìŠ¤íŠ¸ëª…     |
| ansible_user       | ì ‘ì† ê³„ì •                |
| ansible_port       | SSH í¬íŠ¸ (ê¸°ë³¸ 22)       |
| ansible_connection | ì—°ê²° ë°©ì‹ (ssh, winrm ë“±) |

 
ğŸ“˜ **ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´**
ansible -i hosts all -m ping

---

**ğŸ“œ 4. YAML ê¸°ë³¸ ë¬¸ë²•**
**YAML (Yet Another Markup Language)** ì€ ì‚¬ëŒì´ ì½ê¸° ì‰¬ìš´ ë°ì´í„° í¬ë§·ì…ë‹ˆë‹¤.
Ansibleì—ì„œëŠ” Playbook ì‘ì„±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
**âœï¸ ì˜ˆì‹œ**
name: BK favorite_foods: - Pizza - Tacos - Sushi
> ë“¤ì—¬ì“°ê¸°ë¡œ ê³„ì¸µ êµ¬ì¡°ë¥¼ í‘œí˜„í•˜ë©°, ê°€ë…ì„±ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.

---

**âš™ï¸ 5. Playbook**
**Playbook** ì€ ì—¬ëŸ¬ ì‘ì—…(Task)ì„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” **ìë™í™” ìŠ¤í¬ë¦½íŠ¸** ì…ë‹ˆë‹¤.
**ğŸ”§ ê¸°ë³¸ êµ¬ì¡°**
\- name: Apache ì„¤ì¹˜ hosts: webservers become: yes tasks: - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜ yum: name: httpd state: present - name: ì„œë¹„ìŠ¤ ì‹œì‘ service: name: httpd state: started
**ğŸ–¥ï¸ ì‹¤í–‰ ëª…ë ¹ì–´**
ansible-playbook site.yml -i inventory.ini

---

**ğŸ§± 6. Module (ëª¨ë“ˆ)**
ëª¨ë“ˆì€ Ansibleì˜ â€œì‘ì—… ë‹¨ìœ„â€ì…ë‹ˆë‹¤.
ì„œë²„ ì„¤ì •, íŒŒì¼ ë³µì‚¬, ì„œë¹„ìŠ¤ ì œì–´ ë“± ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì€ ëª¨ë“ˆë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.

| ëª¨ë“ˆ              | ì„¤ëª…                 |
| --------------- | ------------------ |
| copy            | íŒŒì¼ ë³µì‚¬              |
| template        | Jinja2 í…œí”Œë¦¿ ì ìš©      |
| yum / apt       | íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ì œê±°        |
| service         | ì„œë¹„ìŠ¤ ì‹œì‘/ì¤‘ì§€/ì¬ì‹œì‘      |
| user / group    | ì‚¬ìš©ì, ê·¸ë£¹ ê´€ë¦¬         |
| file            | íŒŒì¼/ë””ë ‰í„°ë¦¬ ìƒì„± ë° ê¶Œí•œ ì„¤ì • |
| shell / command | ëª…ë ¹ì–´ ì‹¤í–‰             |
| lineinfile      | íŒŒì¼ íŠ¹ì • ì¤„ ìˆ˜ì •/ì¶”ê°€      |

---

**ğŸ§® 7. Variable (ë³€ìˆ˜)**
ë°˜ë³µë˜ëŠ” ê°’ì´ë‚˜ ì¡°ê±´ì— ë”°ë¼ ë³€í•˜ëŠ” ë°ì´í„°ë¥¼ ë³€ìˆ˜ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
vars: app_name: nginx tasks: - name: "{{ app_name }} ì„¤ì¹˜" yum: name: "{{ app_name }}" state: present
ğŸ“Œ **ì°¸ì¡° ë¬¸ë²•:** {{ ë³€ìˆ˜ëª… }}
**ë³€ìˆ˜ ìš°ì„ ìˆœìœ„**
-e > task vars > play vars > role vars > inventory vars > role default

---

**âš–ï¸ 8. ì¡°ê±´ë¬¸ (when)**
ì¡°ê±´ì— ë”°ë¼ Taskë¥¼ ì‹¤í–‰í• ì§€ ê²°ì •í•©ë‹ˆë‹¤.
\- name: CentOSì¸ ê²½ìš°ë§Œ ì‹¤í–‰ yum: name: httpd state: present when: ansible_os_family == "RedHat"

---

**ğŸ” 9. ë°˜ë³µë¬¸ (loop)**
ê°™ì€ ì‘ì—…ì„ ì—¬ëŸ¬ ê°’ì— ëŒ€í•´ ë°˜ë³µ ì‹¤í–‰í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
\- name: ì—¬ëŸ¬ íŒ¨í‚¤ì§€ ì„¤ì¹˜ yum: name: "{{ item }}" state: present loop: - httpd - vim - git

---

**ğŸ§© 10. Role**
Playbookì„ êµ¬ì¡°í™”í•˜ê³  ì¬ì‚¬ìš©í•˜ê¸° ìœ„í•œ ë‹¨ìœ„ì…ë‹ˆë‹¤.
**ë””ë ‰í† ë¦¬ êµ¬ì¡°**
roles/ setup_nginx/ tasks/main.yml handlers/main.yml templates/ files/ vars/main.yml 
**ìƒì„± ëª…ë ¹ì–´**
ansible-galaxy init setup_nginx 
**Playbook ë‚´ í˜¸ì¶œ**
roles: - setup_nginx

---

**ğŸ“˜ 11. ì¸ë²¤í† ë¦¬ íŒ¨í„´ (Pattern)**

| íŒ¨í„´                   | ì„¤ëª…        |
| -------------------- | --------- |
| all                  | ëª¨ë“  í˜¸ìŠ¤íŠ¸    |
| host1:host2          | ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ ì§€ì • |
| webservers:dbservers | ì—¬ëŸ¬ ê·¸ë£¹ ì§€ì •  |
| webservers:!atlanta  | íŠ¹ì • ê·¸ë£¹ ì œì™¸  |
| webservers:&staging  | ê³µí†µ í¬í•¨ ê·¸ë£¹  |

---

**âš™ï¸ 12. ì‹¤í–‰ ì „ëµ (Strategy)**

| ì „ëµ             | ì„¤ëª…         |
| -------------- | ---------- |
| linear         | ê¸°ë³¸ê°’, ìˆœì°¨ ì‹¤í–‰ |
| free           | ë³‘ë ¬ ì‹¤í–‰ ê°€ëŠ¥   |
| serial         | ì§€ì •ëœ ê°œìˆ˜ì”© ì‹¤í–‰ |
| rolling update | ì ì§„ì  ì—…ë°ì´íŠ¸   |

---

**ğŸ ë§ˆë¬´ë¦¬ ìš”ì•½**

| í•­ëª©               | í•µì‹¬ ìš”ì•½                    |
| ---------------- | ------------------------ |
| Ansible íŠ¹ì§•       | Agentless, YAML, Push ë°©ì‹ |
| Inventory        | ì œì–´í•  ì„œë²„ ëª©ë¡                |
| Playbook         | ìë™í™” ì‹œë‚˜ë¦¬ì˜¤ ì •ì˜              |
| Module           | ì‹¤ì œ ì‘ì—… ìˆ˜í–‰ ë‹¨ìœ„              |
| Variable         | ê°’ ì¬ì‚¬ìš© ë° ë™ì  ì²˜ë¦¬            |
| Condition / Loop | ì¡°ê±´, ë°˜ë³µ ì§€ì›                |
| Role             | êµ¬ì¡°í™” ë° ì¬ì‚¬ìš©ì„± ê°•í™”            |

---

> ğŸ’¬ **TIP** :
> Ansibleì€ â€œëª…ë ¹ì–´ ìë™í™”â€ë³´ë‹¤ â€œì‹œìŠ¤í…œ ê´€ë¦¬ì˜ ì½”ë“œí™”â€ì— ê°€ê¹ìŠµë‹ˆë‹¤.
> ì‘ì€ ìë™í™”ë¶€í„° ì‹œì‘í•´ì„œ ì ì  Role ê¸°ë°˜ êµ¬ì¡°ë¡œ ë°œì „ì‹œí‚¤ë©´
> ëŒ€ê·œëª¨ ì¸í”„ë¼ë„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸš€
**â€‹**

[ì›ë¬¸ ë³´ê¸°](https://blog.naver.com/choidz_/224059741734?fromRss=true&trackingCode=rss)
